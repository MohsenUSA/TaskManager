<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Task Management</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAMAEBAAAAEAIABoBAAANgAAACAgAAABACAAKBEAAJ4EAAAwMAAAAQAgAGgmAADGFQAAKAAAABAAAAAgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACV3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHj6/yV3+v8ld/r/JHf6/yV3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yV3+v8kd/r/JHf6/yR4+v8kd/r/JXj6/yR4+v8ld/r/JXf6/yR3+f8md/n/J3j5/yd4+f8nd/n/J3f5/yZ3+f8ld/n/JHf5/yV3+v8kd/r/JXf6/yV3+v8ld/r/JXf5/0SJ+v/L3v3//P3///7+///+/v///v7///7+///8/f//zN79/0OI+v8ld/n/JHf6/yR3+v8ld/r/JXf6/yV3+f/O4P3////////////////////////////////////////////M3v3/JXf5/yV3+v8kd/r/JHf6/yV3+v8nd/n//f7/////////////6fH+/9rn/v///////////////////////P3//yZ3+f8ld/r/JHf6/yV3+v8ld/r/KXn5////////////4+3+/0CI+v8tfPr/xdr9//////////////////7+//8nePn/JXf6/yV3+v8kd/r/JXf6/yl5+f//////4u3+/z+H+v88hfr/UJL7/yx7+v/E2v3////////////+/v//J3j5/yR3+v8ld/r/JXf6/yR3+v8oePn//////6LF/P8+hvr/4Oz+//L2/v9Tk/v/LHv6/8PZ/f///////v7//yd4+f8kd/r/JHf6/yR3+v8kd/r/KHn5/////////////v7/////////////8vf+/1ST+/8se/r/w9n9//7+//8nd/n/JXf6/yR3+v8kd/r/JXf6/yd4+f/+/v/////////////////////////////y9/7/VJT7/2Kc+//9/v//Jnf5/yV3+v8ld/r/JHf6/yV3+v8ld/n/1OT+//////////////////////////////////r8///2+f//0OH9/yV3+f8ld/r/JXf6/yR3+v8ld/r/JXf6/0uO+v/X5f7/////////////////////////////////1OP+/0eL+v8ld/n/JXf6/yV4+v8kd/r/JHf6/yR3+v8ld/r/JXf5/yt6+f8ufPn/L3z5/y58+f8vfPn/K3r5/yV3+f8ld/n/JHj6/yV4+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yV3+v8ld/r/JXf5/yV3+f8ld/r/JHf6/yV3+v8kePr/JHj6/yR3+v8kePr/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yV3+v8kd/r/JHj6/yV4+v8kd/r/JHf6/yR3+v8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAACAAAABAAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf5/yR3+v8kd/r/JHf6/yR3+v8kd/n/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yV3+v8kd/r/JXf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR4+v8kd/r/JXf6/yV4+v8kd/r/JXf6/yR3+v8ld/r/JXf6/yR3+v8kePr/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR4+v8kd/r/JHj6/yV4+v8ld/r/JHf6/yV3+v8kd/r/JHf6/yR4+v8ld/r/JHf6/yV3+v8kd/r/JHf6/yR3+f8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yV3+v8ld/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHj6/yR3+v8kd/r/JHj6/yV3+v8kd/r/JXj6/yR3+v8ld/r/JHf5/yV3+f8ld/n/JXf5/yR3+v8kd/n/JHf5/yR3+f8kd/n/JHf5/yV3+f8ld/n/JXf5/yV3+f8kd/r/JHf6/yR3+f8ld/r/JHf6/yR4+v8kd/r/JHf6/yR3+v8lePr/JXf6/yV3+v8kePr/JXf6/yV3+v8ld/r/JHf5/yR2+f8kdvn/JHX5/yh3+f8pePn/KXj5/yl4+f8pePn/KXf5/yl4+f8pePn/KXf5/yl4+f8kdfn/JXb5/yR3+f8ld/n/JHf5/yV3+v8kd/n/JHf6/yV3+v8lePr/JXf6/yV3+v8kd/r/JHf6/yV3+v8ld/r/JXf6/yV2+f8ldfn/aZ/7/8fb/f/1+P///v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///b5///J3P3/a6D7/yR1+f8kd/n/JHf5/yR3+v8kd/r/JXf6/yR3+v8ld/r/JXf6/yV3+v8kd/r/JXj6/yV3+f8kd/n/JXb5/6DC/P//////////////////////////////////////////////////////////////////////////////////////ncD8/yV1+f8ld/n/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8lePr/JHf6/yV2+f9uo/v/////////////////////////////////////////////////////////////////////////////////////////////////aqD7/yV2+f8ld/r/JHf6/yV3+v8kd/r/JXf6/yV3+v8kd/r/JHf6/yV3+v8ld/n/JXb5/83f/f/////////////////////////////////////////////////////////////////////////////////////////////////J3P3/JXb5/yV3+f8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yV3+f8mdvn/+fv///////////////////////////////////////////////////////////////////////////////////////////////////b5/v8ldfn/JXf6/yV3+v8ld/r/JHf5/yR3+v8kd/r/JXf6/yV3+v8ld/r/JXf5/yt5+f//////////////////////////////////////qMj9/4Gv/P/p8f7//////////////////////////////////////////////////v7//yl4+f8ld/r/JXf6/yV3+v8ld/r/JHf6/yV3+v8ld/r/JHf6/yV3+v8ld/n/LHr5/////////////////////////////////5G6/P8kd/r/JXf6/0SK+v/o8P7////////////////////////////////////////////+/v//KXj5/yV3+f8ld/r/JXf6/yV3+v8ld/r/JHf6/yR3+v8ld/r/JXj6/yV3+f8sevn///////////////////////////+Qufz/JHf6/yV3+v8ld/r/JHf6/0SK+//o8P7///////////////////////////////////////7+//8pePn/JXf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JXf5/yx6+f//////////////////////jrf8/yR3+v8kd/r/JHf6/yZ4+v8kd/r/JHf6/0SJ+v/n8P7//////////////////////////////////v7//yl4+f8ld/n/JXf6/yR3+f8kd/r/JHf6/yR3+v8ld/r/JHf6/yV3+v8ld/n/LHr5/////////////////423/P8kd/r/JHf6/yR2+v+CsPz/yNz9/y58+v8kd/r/JHb5/0SJ+v/n8P7////////////////////////////+/v//KXj5/yV3+v8kd/r/JHf6/yV3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yV3+f8sevn////////////w9f7/JHb6/yV2+v8kd/r/hLL8//7/////////yt39/y99+v8kd/r/JHb6/0OJ+v/m7/7///////////////////////7+//8pePn/JXf5/yR3+v8kd/r/JHf6/yV3+v8kd/r/JXf6/yR3+v8kd/r/JHf5/yt5+f////////////////93qfv/Jnf6/4m0/P/+////////////////////y979/y98+v8kd/r/JXf6/0OI+//m7/7//////////////////v7//yl4+f8kd/r/JHf6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/n/K3r5///////////////////////7/P//////////////////////////////////y979/y99+v8kdvr/JXf6/0KI+v/l7/7////////////+/v//KXf5/yV3+f8ld/r/JXf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JXf6/yV3+f8revn/////////////////////////////////////////////////////////////////zN79/y99+v8ld/r/JXf6/0GI+v/m7/7///////7+//8pePn/JHf5/yV3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JXf5/yt6+f/+////////////////////////////////////////////////////////////////////zN/9/y99+v8ld/r/JXb5/4Sx+////////v7//yl4+f8ld/n/JXf6/yR3+v8ld/r/JXj6/yR3+v8kd/r/JHf6/yV3+v8ld/n/Jnb5//v9////////////////////////////////////////////////////////////////////////zN/9/zF++v8ldvr/uNL9///////5+///JXb5/yV3+f8kd/r/JXj6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+f8ldvn/1eT+////////////////////////////////////////////////////////////////////////////7PP+/9vo/v///////////8/g/f8ldvn/JXf6/yV3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JXf6/yV3+f9+rfv/////////////////////////////////////////////////////////////////////////////////////////////////c6b7/yR3+f8ld/r/JXj6/yV3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yV3+v8ld/r/JHf6/yZ3+f+50v3//////////////////////////////////////////////////////////////////////////////////////6zK/P8ldvn/JXf5/yV3+v8ld/r/JHf6/yV3+v8ld/r/JHf6/yR3+f8kd/r/JXf6/yV3+v8ld/r/JXf5/yd3+f+Cr/v/2+j+//7+/////////////////////////////////////////////////////////v7//9fl/v96qvv/Jnb5/yV3+f8ld/n/JHf6/yV4+v8ld/r/JXj6/yV4+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yV3+v8ld/r/JXf5/yV2+f8ldvn/LHn5/zeA+f84gPn/OIH5/ziB+f84gfn/OIH5/ziB+f84gfn/OID5/zeA+f8sefn/JXb5/yV3+f8kd/n/JXf5/yR3+v8kePr/JHj6/yV3+v8kePr/JHf6/yR3+v8kd/r/JHf6/yR4+v8kd/r/JHf6/yV3+v8ld/r/JXf5/yR3+f8ld/n/JXf5/yV3+f8kd/n/JXf5/yV3+f8kd/n/JXf5/yV3+f8ld/n/JXf5/yV3+f8ld/n/JHf6/yV3+v8ld/r/JXj6/yR3+v8ld/r/JXj6/yR3+v8kd/r/JHf5/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8kd/n/JHf6/yV3+v8ld/r/JXf6/yR3+v8ld/r/JHf6/yR3+v8ld/n/JXf5/yV3+f8ld/r/JXf5/yV3+v8ld/r/JHf6/yV3+f8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yV3+v8kd/r/JHf5/yV4+v8kd/r/JHf6/yV3+v8kd/r/JHf5/yR3+f8ld/n/JXf6/yV3+v8kePr/JHf6/yR3+v8kd/r/JHj6/yV4+v8kePr/JHj6/yR3+v8kd/r/JHj6/yV3+v8kd/r/JHj6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf5/yR3+f8kd/r/JHf5/yR3+v8ld/r/JHf6/yR3+v8ld/r/JHf5/yR3+v8kePr/JHf6/yR4+v8ld/r/JHj6/yR3+v8kd/r/JHf6/yR4+v8kd/n/JHf6/yR3+v8kePr/JHf6/yV3+v8kd/r/JHf6/yR4+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8lePr/JHj6/yV3+v8kd/r/JHf6/yR4+v8kd/r/JHf6/yV4+f8kd/r/JXf6/yR3+v8ld/r/JHf6/yV3+v8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+f8kd/r/JHb5/yR3+v8kd/r/JHb6/yR3+v8kd/r/JHf6/yR3+v8kd/n/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR4+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR4+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kePr/JHf6/yR3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHj6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JXf5/yR3+v8kd/r/JHf6/yR4+v8kd/r/JHj6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JXf6/yR3+v8kd/r/JHf5/yR3+v8kd/r/JHf6/yV3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHj6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHj6/yR3+v8lePr/JXf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yR3+v8kePr/JHf6/yR3+v8kd/r/JHf6/yR3+f8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR4+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR4+v8kd/r/JHf6/yV4+v8lePr/JXf6/yV4+v8kd/r/JXf6/yR3+v8ld/r/JXf6/yR4+v8kd/r/JHf6/yV4+v8lePr/JXj6/yV3+v8kd/r/JXf6/yR3+v8kd/r/JXf6/yV3+v8ld/r/JHf6/yR4+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kePr/JHf6/yR3+v8ld/r/JXf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JXj6/yV3+v8ld/r/JHf6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JHb5/yV3+f8ld/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf5/yV3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yV4+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHj6/yR3+v8ld/r/JHj6/yR4+v8kd/r/JXf6/yR4+v8kd/r/JHf6/yR3+v8kd/r/JHj6/yR3+v8ld/r/JHj6/yR3+v8kd/r/JXf6/yV3+v8kd/r/JXf5/yV3+f8ld/n/JHf6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+f8kd/n/JHf6/yR3+v8ld/n/JXf6/yR3+v8kd/n/JHf6/yR4+v8ld/n/JXf6/yR3+v8kd/n/JXf5/yR4+v8ld/r/JHf6/yR4+v8kePr/JHf6/yR4+v8kd/r/JHf6/yR4+v8lePr/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yR3+f8kd/n/JHf5/yV3+f8kd/n/JXf5/yV2+f8kdvn/JHb5/yR2+f8ldvn/JXb5/yR2+f8kdvn/JHf5/yR3+f8ldvn/JXb5/yV2+f8ldvn/JXf5/yV3+f8ld/n/JHf5/yV3+v8kd/n/JHf6/yV3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8ld/r/JXf6/yV4+v8kd/r/JXf6/yV3+v8ld/r/JXf6/yV3+v8kd/r/JXf5/yR2+f8kdfn/JXX5/yV1+f8mdfn/K3j5/yx5+f8sefn/LHn5/yx5+f8sefn/LHn5/yx4+f8sefn/LHn5/yx5+f8sefn/LHj5/yx5+f8ndvn/JXX5/yV1+f8ldvn/JHb5/yR3+f8ld/n/JHf5/yV3+v8ld/n/JHf6/yR3+v8ld/r/JXf6/yV4+v8lePr/JHf6/yR3+v8ld/r/JHf6/yV3+v8ld/n/JHf6/yV3+v8ld/r/JXf6/yV3+v8kdvn/JXX5/zV/+f9nnvv/tM/8/+bv/v/8/f///v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+///+/v///v7///7+///9/f//6fH+/7fQ/f9qoPv/Nn/5/yR1+f8kdvn/JHf5/yV3+v8kd/n/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8ld/r/JXf6/yR3+v8kd/r/JXf6/yV3+v8ld/n/JHf5/yV2+f8ldvn/XZf6/8HX/f/4+//////////////////////////////////////////////////////////////////////////////////////////////////////////////5+///wtj9/1uX+v8ldfn/JHb5/yR2+f8kd/n/JXf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JXf6/yV3+v8ld/r/JHf6/yV3+v8kd/r/JXj6/yR3+v8kd/n/JHb5/yV2+f9emPv/4uz+///////////////////////////////+/////////////////////////////////////////////////////////////////////////////////////////////////+Dr/v9blvr/JXX5/yR2+f8ld/n/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf5/yR3+v8ld/r/JHj6/yR3+v8kePr/JXf6/yR3+v8kd/n/JXb5/zeB+v/G2v7//////////v////////////////////////////////////////////////////////////////////////////////////////////////////////7////////////////////////C1/3/Nn/5/yV2+f8ld/n/JHf6/yR3+v8ld/r/JXf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8ld/r/JXj6/yR3+v8ld/n/JXX5/2+j+//6/P/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5+///aaD7/yV1+f8ld/n/JXf5/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHj6/yR3+v8ld/r/JXf6/yR3+v8ld/n/JXX5/77V/f//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////t9H9/yV1+f8ld/n/JXf6/yV3+v8kd/r/JXj6/yV4+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yV3+v8ld/n/JXX5/+/0/v//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6fH+/yV1+f8ldvn/JXf6/yV3+v8ld/r/JXf6/yR3+f8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8ld/n/K3n5//7/////////////////////////////////////////////////////////9Pj//+bv/v/7/P///////////////////////////////////////////////////////////////////////////////////P3//yd2+f8ldvn/JXf6/yR3+v8ld/r/JXf6/yR3+f8kd/r/JHf6/yR3+v8ld/r/JHf6/yV3+v8ld/r/JXf6/yV3+v8ld/n/MHz5///////////////////////////////////////////////////////U5P7/V5X7/0GI+/+Br/z/8/f//////////////////////////////////////////////////////////////////////////////v7//yt5+f8ld/n/JXf6/yV3+v8ld/r/JXf6/yV3+v8kd/r/JHj6/yR3+v8ld/r/JHf6/yV3+v8kd/r/JXj6/yR3+v8ld/n/MXz5///+/////////////////////////////////////////////9ro/v9Skvv/JHf6/yV2+v8ld/r/fKz7//L3//////////////////////////////////////////////7//////////////////////////v7//yx5+f8ld/n/JHf6/yR3+v8ld/r/JXf6/yR3+v8ld/r/JHf5/yR3+v8ld/r/JXf6/yV3+v8ld/r/JXf6/yV3+f8ld/n/MXz5////////////////////////////////////////////0OH+/1GS+/8kdvr/JHf6/yR3+v8ld/r/JHb6/3ap+//o8P7//////////////////////////////////////////////////////////////////v7//yx5+f8ldvn/JXf6/yV3+v8ld/r/JXf6/yV3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR3+f8kePr/JXf6/yR3+v8ld/n/MXz5///////////////////////////////////////Q4f7/SIz7/yR3+v8kd/r/JXf6/yV3+v8ld/r/JHf6/yh5+v92qfz/8vf//////////////////////////////////////////////////////////////v7//yx5+f8ldvn/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yV3+v8ld/r/JXf6/yV3+f8ldvn/MHz5/////////////////////////////////9jm/v9PkPv/JHf6/yR2+v8kd/r/JHf6/yV4+v8kd/r/JHf6/yR3+v8ldvr/fKz8//L3/////////////////////////////////////////////////////////v7//yx5+f8ldvn/JHf6/yV3+v8kd/n/JHf6/yR3+v8kd/r/JHf6/yR3+f8kd/r/JHf6/yV3+v8ld/r/JHf6/yV3+f8ldvn/MXz5////////////////////////////zd/+/06Q+/8kd/r/JHf6/yR2+v8kdvr/RIr7/32t/P8ufPr/JHb6/yR3+v8kdvn/JHb5/3Wo+//n8P7//////////////////////////////////////////////////v7//yx5+f8ld/n/JHf6/yV3+v8kd/n/JHf6/yR3+v8kd/r/JXf6/yR3+v8ld/r/JXf5/yR3+v8kd/r/JXj6/yR3+v8ldvn/MXz5///////////////////////O4P7/Rov7/yR2+v8kd/r/JHf6/yR2+v9Fivv/0OH+//T4//+Ltvz/Knn6/yR3+v8kd/n/JHb6/yh4+v91qPv/8vf//////////////////////////////////////////////v7//yx5+f8ld/n/JXf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yV3+v8ld/r/JHf5/yR3+v8kd/r/JXf6/yV3+f8ldvn/MXz5//////////////////r8//+Esvz/JHb6/yR2+v8ld/r/JHf6/0KJ+v/F2v3////////////4+v//f678/yp6+v8kd/n/JHf6/yR2+v8ldvn/eav8//H2/////////////////////////////////////////v7//yx5+f8ldvn/JHf6/yV3+v8kd/r/JHf6/yV3+v8kd/r/JXf5/yR3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8ldvn/MHz5//////////////////z9//+VvPz/KHn6/yV2+v8ldvr/SIz6/8bb/f/+////////////////////+Pr//463/P8vfPr/JHb6/yR3+v8kdvr/JHb6/3On+//m7/7//////////////////////////////////v7//yx5+f8ld/n/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8ld/r/JXf6/yV3+v8kd/r/JHf6/yR3+v8ldvn/MHz5///////////////////////r8v7/daj7/yZ3+v9PkPv/1eT+//////////////////////////////////b5//+Ot/z/Knr6/yR3+v8kd/r/JXf6/yh4+v9zpvv/8fb//////////////////////////////v7//yx5+f8ld/n/JHf6/yV3+v8kd/r/JXf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf5/yV3+v8kd/n/MHz5//7///////////////////////////////j7///8/f/////////////////////////////////////////////5+v//ga/8/yp6+v8kdvn/JXb6/yV3+v8ldvr/dqn7//H2/////////////////////////v7//yx4+f8kdvn/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JXf6/yR3+v8ld/r/JXf6/yV3+f8ld/n/MHz5////////////////////////////////////////////////////////////////////////////////////////////+fv//464/P8vffr/JHf6/yV3+v8ld/r/JXf6/3Cl+//l7v7//////////////////v7//yx5+f8kdvn/JHf6/yV3+v8ld/r/JXf6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JXf6/yV3+v8ldvn/MHz5//7///////////////////////////////////////////////////////////////////////////////////////////////b5//+PuPz/Knr6/yR2+v8ld/r/JXf6/yh4+v9ypvv/8fb//////////////v7//yx5+f8kdvn/JHf6/yV3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+f8kd/r/JXf6/yV3+v8ldvn/MHz5//7///////////////////////////7////+///////////////////////////////////////////////////////////////////5+///grD8/yp6+v8kd/r/JHb6/yV2+f8nd/n/yt39/////////////v7//yx5+f8ld/n/JHf6/yV3+v8kd/r/JHf6/yR3+v8ld/r/JXj6/yV3+v8kd/r/JHf6/yR3+v8ld/r/JXf6/yV3+v8ldvn/LXr5//7/////////////////////////////////////////////////////////////////////////////////////////////////////////+fv//4+5/P8vffr/JXf6/yV2+f8oePn/x9z9/////////////v7//yh3+f8ld/n/JXf6/yR3+v8ld/r/JXf6/yV3+v8kd/r/JHj6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JXf6/yV4+v8ld/n/JXX5//X5/v////////////////////////////////////////////////////////////////////////////////////////////////////////////b5//+Ruvz/K3v6/yR2+v9jnPv/7vT+////////////7/T+/yR1+f8ld/n/JHf6/yR3+v8lePr/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXj6/yR3+v8kd/n/JXX5/8rd/f///////////////////////v/////////////////////////////////////////////////////////////////////////////////////////+/v//zeD+/7LO/f/t8///////////////////wdf9/yR1+f8ld/n/JHf6/yR3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yV3+f8ld/r/JXb5/36s/P/+/v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8/f//c6b7/yR2+f8ld/n/JXf6/yV4+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JXf6/yV3+v8kd/r/JXf6/yV3+v8ld/r/JHb5/z6F+v/V5f7////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////L3v3/OoL5/yV3+f8ld/r/JXf6/yV4+v8lePr/JXf6/yV3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yV3+f9zpfv/7vT+///////////////////////////////////////////////////+/////////////////////////////////////////////////////////////////////////////+jw/v9nnvv/JXb5/yV2+f8ld/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8ld/r/JXf6/yR3+v8kd/r/JHf5/yR3+v8kd/r/JXf6/yV3+v8kd/r/JXf6/yV3+f8qefn/daf7/9nm/v/+/v/////////////////////////////////////////////////////////////////////////////////////////////////////////////9/v//0OH+/2mg+/8nd/n/JXb5/yR3+f8kd/n/JHf6/yR3+v8kd/r/JHf6/yR3+v8kePr/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yV3+v8ld/r/JXf6/yV3+v8ldvn/Jnf5/0GH+v+Gsvz/1OP+//3+/v////////////////////////////////////////////7//////////////////////////////////////////Pz//8/g/v9+rPv/PYT6/yV2+f8ldvn/JXf5/yR3+v8ld/r/JHf6/yV4+v8ld/r/JXf6/yV4+v8lePr/JHj6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JXj6/yV3+v8kd/r/JXf6/yV3+v8ld/r/JXb5/yV2+f8ldfn/JXX5/yt4+f8+g/r/RIf6/0WH+v9FiPr/RYj6/0WI+v9FiPr/RYj6/0WI+v9FiPr/RYj6/0WI+v9FiPr/RYj6/0SH+v89hPn/Knj5/yV1+f8ldvn/JXb5/yR2+f8ld/n/JHf5/yR3+f8kd/r/JHj6/yR4+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JXf6/yV3+v8ld/r/JXf6/yV3+f8ld/n/JHf5/yV2+f8ldvn/JXb5/yV2+f8ldvn/JXf5/yV2+f8ldvn/JXb5/yV2+f8ldvn/JXb5/yV2+f8ldvn/JXb5/yV2+f8ld/n/JXf5/yV3+f8ld/n/JHf5/yR3+v8ld/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yR4+v8kePr/JHj6/yR3+v8kd/r/JHf6/yR3+v8kePr/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/yR3+f8kd/n/JHf5/yV3+v8ld/n/JHb5/yR3+f8ld/n/JHf6/yV3+f8ld/n/JHf5/yR3+f8ld/n/JXf5/yV3+f8ld/n/JXf6/yV3+v8ld/n/JXf6/yV3+f8ld/r/JHf6/yR3+v8ld/r/JHf6/yV4+v8ld/r/JHf6/yV3+v8ld/r/JHj6/yR3+v8kd/r/JHf6/yR3+v8kd/n/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JXf5/yR3+f8ld/n/JHf6/yV3+v8ld/r/JXf6/yR3+v8ld/r/JHf6/yR3+v8ld/r/JHf6/yV3+v8kd/n/JXf6/yR3+f8ld/n/JXf6/yV3+v8ld/n/JXj6/yR3+v8ld/r/JXf6/yR3+v8ld/r/JHf5/yV3+v8ld/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf5/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/n/JHf6/yR3+v8ld/r/JHf6/yV3+v8kd/r/JHf6/yV3+v8ld/r/JHf6/yR3+v8kd/r/JXf5/yR3+f8kd/n/JXf5/yR3+v8ld/n/JXf6/yV3+v8ld/r/JXf6/yR3+v8kd/r/JXf6/yR3+v8kd/r/JHf6/yR4+v8kePr/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf5/yR3+v8kd/r/JHf5/yR3+v8ld/r/JHf5/yR3+f8kd/n/JHf5/yR3+v8lePr/JHf6/yR3+v8kd/r/JXj6/yV3+v8kd/n/JHf5/yR3+f8ld/n/JXf6/yR3+f8ld/r/JHf5/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR4+v8kePr/JXj6/yV4+v8kePr/JHj6/yR3+v8kd/r/JHf6/yR4+v8kePr/JXj6/yR3+v8kePr/JHf6/yR4+v8kd/r/JHf6/yR3+f8kd/r/JHf6/yV3+v8kd/n/JHf5/yR3+f8kd/r/JHf6/yV3+v8kd/r/JHf6/yV3+v8ld/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/n/JHf6/yR4+v8kd/r/JHf6/yR3+v8kePr/JHf6/yR4+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR4+v8kePr/JHf5/yR3+v8kd/r/JHf6/yR4+v8kd/r/JHf6/yR3+v8lePr/JHj6/yR3+v8kd/r/JHf6/yR3+v8ld/r/JHf6/yR3+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR3+f8kd/r/JHf6/yR3+v8kd/r/JXf6/yR4+v8kd/r/JXf6/yR3+f8kd/r/JHf6/yR3+v8kePr/JHf6/yR3+v8kd/r/JXf5/yR3+v8kd/r/JXf6/yR3+v8ld/r/JXj6/yR4+v8kd/r/JHf6/yR3+v8kd/r/JHf6/yR4+v8kd/r/JXj6/yV3+v8ld/r/JHf6/yR3+v8kd/r/JHj6/yR3+v8kd/r/JHf6/yV3+v8kd/r/JHf6/yR4+v8ld/r/JHf6/yR3+v8kd/r/JXf6/yR3+v8kePr/JXj6/yV4+v8kd/r/JXf6/yR4+v8kd/r/JHf6/yR3+v8kePr/JHf6/yR3+v8ld/r/JHj6/yR3+v8ld/r/JHf6/yV3+v8kd/r/JHf6/yR3+v8kd/r/JXf6/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==">
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            min-height: 100vh;
            padding: 20px;
        }

        a {
            text-decoration: none;
        }

        a.btn {
            text-decoration: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: white;
            color: #333;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .demo-badge {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: inline-block;
            margin: 5px;
        }

        .clock {
            font-size: 2em;
            font-weight: 300;
            margin-top: 0;
            padding: 12px 20px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            display: inline-block;
        }

        .current-date {
            font-size: 1.2em;
            padding: 8px 16px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .control-section {
            margin-bottom: 15px;
        }

        .control-section label {
            font-weight: 600;
            color: #495057;
            display: block;
            margin-bottom: 5px;
        }

        .file-upload-area {
            border: 3px dashed #dee2e6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: white;
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .file-upload-area:hover,
        .file-upload-area.drag-over {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.01);
        }

        .file-upload-area.has-file {
            border-color: #28a745;
            background: #d4edda;
        }

        .file-upload-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .file-upload-text {
            font-size: 1.1em;
            color: #495057;
            margin-bottom: 10px;
        }

        .file-name-display {
            color: #28a745;
            font-weight: 600;
            margin-top: 10px;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .search-filter-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: end;
            margin-bottom: 15px;
        }

        .input-group {
            flex: 1;
            min-width: 200px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 1em;
        }

        .available-dates {
            margin: 0 0 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .available-dates-label {
            font-size: 0.85em;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .date-chips {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .date-chip {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .date-chip:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .date-chip.active {
            background: #667eea;
            color: white;
        }

        .no-dates-message {
            font-size: 0.85em;
            color: #6c757d;
            font-style: italic;
        }

        .btn {
            padding: 10px 20px;
            border: 2px solid;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            border-color: #667eea;
            color: #667eea;
        }

        .btn-primary:hover {
            background: #667eea;
            color: white;
        }

        .btn-success {
            border-color: #28a745;
            color: #28a745;
        }

        .btn-success:hover {
            background: #28a745;
            color: white;
        }

        .btn-info {
            border-color: #17a2b8;
            color: #17a2b8;
        }

        .btn-info:hover {
            background: #17a2b8;
            color: white;
        }

        .btn-secondary {
            border-color: #6c757d;
            color: #6c757d;
        }

        .btn-secondary:hover {
            background: #6c757d;
            color: white;
        }

        .btn-warning {
            border-color: #e0a800;
            color: #e0a800;
        }

        .btn-warning:hover {
            background: #e0a800;
            color: white;
        }

        .btn-danger {
            border-color: #dc3545;
            color: #dc3545;
        }

        .btn-danger:hover {
            background: #dc3545;
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
            justify-content: center;
        }

        .content {
            padding: 30px;
        }

        .demo-note {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 4px solid #667eea;
            padding: 0;
            margin-bottom: 20px;
            border-radius: 5px;
            overflow: hidden;
        }

        .demo-note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .demo-note-header:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .demo-note-header h4 {
            color: #667eea;
            margin: 0;
            font-size: 1.3em;
        }

        .demo-note-toggle {
            background: none;
            border: none;
            color: #667eea;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px 10px;
            transition: transform 0.3s;
            font-weight: bold;
        }

        .demo-note-toggle:hover {
            color: #5568d3;
        }

        .demo-note-content {
            padding: 0 20px 20px 20px;
            transition: all 0.3s ease;
        }

        .demo-note-content.collapsed {
            display: none;
        }

        .demo-note-content p {
            color: #495057;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .demo-note-content strong {
            color: #667eea;
        }

        .demo-note-content ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .demo-note-content li {
            margin-bottom: 8px;
            color: #495057;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            border-radius: 8px;
            text-align: center;
            color: white;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: scale(1.05);
        }

        .stat-card h3 {
            font-size: 1.5em;
            margin-bottom: 3px;
        }

        .stat-card p {
            font-size: 0.8em;
            opacity: 0.9;
        }

        .stat-total {
            background: #9ca3af;
            color: white;
        }

        .stat-allday {
            background: #93c5fd;
            color: #1e3a5f;
        }

        .stat-completed {
            background: #a7f3d0;
            color: #166534;
        }

        .stat-progress {
            background: #fde68a;
            color: #92400e;
        }

        .stat-pending {
            background: #fecaca;
            color: #991b1b;
        }

        .metrics-section {
            background: linear-gradient(135deg, #f5e6d315 0%, #e8d4b815 100%);
            border-left: 4px solid #d4a574;
            border-radius: 5px;
            padding: 0;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .metrics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            cursor: pointer;
            transition: background 0.3s;
            flex-wrap: wrap;
            gap: 10px;
        }

        .metrics-header:hover {
            background: rgba(212, 165, 116, 0.1);
        }

        .metrics-header h3 {
            color: #495057;
            font-size: 1.4em;
            margin: 0;
        }

        .metrics-content {
            padding: 0 20px 20px 20px;
            transition: all 0.3s ease;
        }

        .metrics-content.collapsed {
            display: none;
        }

        .metrics-toggle {
            background: none;
            border: none;
            color: #d4a574;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px 10px;
            transition: transform 0.3s;
            font-weight: bold;
        }

        .metrics-toggle:hover {
            color: #b8956a;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .metric-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .metric-card-wide {
            grid-column: 1 / -1;
        }

        .metric-header {
            margin-bottom: 15px;
        }

        .metric-title {
            font-weight: 700;
            color: #495057;
            font-size: 1.1em;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 600;
            color: #6c757d;
        }

        .metric-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
            min-width: 40px;
            text-align: right;
        }

        .priority-breakdown,
        .status-breakdown {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .employee-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }

        .employee-metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #667eea;
            transition: all 0.2s;
        }

        .employee-metric-item:hover {
            background: #e7f0ff;
            transform: translateX(3px);
        }

        .employee-name {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
            word-break: break-word;
        }

        .employee-task-count {
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 700;
            min-width: 30px;
            text-align: center;
            flex-shrink: 0;
        }

        .matrix-section {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .matrix-section h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .matrix-grid {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .matrix-table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .matrix-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            white-space: nowrap;
        }

        .matrix-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            color: #495057;
        }

        .matrix-table td:first-child {
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
        }

        .matrix-table tbody tr:hover {
            background: #f8f9fa;
        }

        .matrix-table tbody tr:last-child td {
            border-bottom: none;
        }

        .matrix-table td:last-child {
            background: #f0f4ff;
            font-weight: 700;
            color: #667eea;
        }

        .tasks-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .tasks-header {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .task-count {
            font-size: 0.7em;
            color: #6c757d;
        }

        .task-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #dee2e6;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            z-index: 1;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            z-index: 20;
        }

        .task-card.priority-high {
            border-left-color: #dc3545;
        }

        .task-card.priority-medium {
            border-left-color: #ffc107;
        }

        .task-card.priority-low {
            border-left-color: #28a745;
        }

        .task-card.status-completed {
            opacity: 0.7;
            background: #f8f9fa;
        }

        .task-card.status-completed .task-title {
            text-decoration: line-through;
            color: #6c757d;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .task-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #212529;
            flex: 1;
        }

        .task-time {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .task-time.all-day {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .everyday-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1em;
            opacity: 0.8;
            z-index: 10;
            cursor: help;
        }

        .all-day-tasks-section {
            background: linear-gradient(135deg, #667eea08 0%, #764ba208 100%);
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #667eea;
            border-radius: 10px;
        }

        .all-day-header {
            font-size: 1.2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .all-day-tasks-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-card.all-day {
            margin-bottom: 0;
        }

        .task-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
            align-items: center;
            justify-content: center;
        }

        .task-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .assignees-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
        }

        .assignee-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            background: #e9ecef;
            color: #495057;
            text-align: center;
            display: inline-block;
            line-height: 1.5;
            box-sizing: border-box;
            height: 32px;
            vertical-align: middle;
        }

        .assignee-badge.clickable {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .assignee-badge.clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .assignee-badge.assigned {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .assignee-badge.all-team {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .assignee-badge.all-team:hover {
            transform: scale(1.05);
            border-color: #495057;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        }

        .assignee-badge.all-team:active {
            transform: scale(0.98);
        }

        .assignee-badge.assigned {
            border: 2px solid #3b82f6;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);
        }

        .employee-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.2s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .employee-selector-modal {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .employee-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 2px solid #e9ecef;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .employee-selector-header h3 {
            margin: 0;
            font-size: 1.4em;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            line-height: 1;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .employee-selector-list {
            padding: 15px;
            overflow-y: auto;
            max-height: 60vh;
        }

        .employee-selector-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .employee-selector-item:hover {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-color: #667eea;
            transform: translateX(10px);
        }

        .employee-selector-item:active {
            transform: translateX(5px) scale(0.98);
        }

        .employee-selector-item.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .employee-selector-item.selected:hover {
            background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%);
        }

        .employee-checkbox {
            font-size: 1.2em;
            width: 24px;
            text-align: center;
        }

        .confirm-assignees-btn {
            display: block;
            width: calc(100% - 30px);
            margin: 15px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .confirm-assignees-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .employee-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .employee-name-text {
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
        }

        .floating-anchor {
            position: fixed;
            bottom: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: none;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s;
            border: 1px solid #f57c00;
        }

        .floating-anchor:hover {
            transform: scale(1.1);
            background: #f57c00;
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }

        .floating-anchor:active {
            transform: scale(0.95);
        }

        .floating-anchor-icon {
            font-size: 1em;
            line-height: 1;
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .floating-anchor.at-current .floating-anchor-icon {
            font-weight: 900;
            font-size: 1.25em;
            color: #f57c00;
            margin-top: -1px; /* Visual centering adjustment for arrow character */
        }

        .floating-anchor.at-current {
            background: white;
            border-color: #f57c00;
        }

        .floating-anchor.at-current:hover {
            background: #f57c00;
        }

        .floating-anchor.at-current:hover .floating-anchor-icon {
            color: white;
        }

        .floating-anchor-tooltip {
            position: absolute;
            right: 35px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            font-size: 0.7em;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .floating-anchor:hover .floating-anchor-tooltip {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .floating-anchor {
                width: 25px;
                height: 25px;
                bottom: 10px;
                right: 10px;
            }

            .floating-anchor-icon {
                font-size: 0.8em;
            }

            .floating-anchor.at-current .floating-anchor-icon {
                font-size: 1em;
            }

            .floating-anchor-tooltip {
                display: none;
            }
        }

        .priority-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            min-width: 120px;
            text-align: center;
            display: inline-block;
            line-height: 1.5;
            box-sizing: border-box;
            height: 32px;
            vertical-align: middle;
        }

        .priority-badge.high {
            background: #dc3545;
            color: white;
        }

        .priority-badge.medium {
            background: #ffc107;
            color: #333;
        }

        .priority-badge.low {
            background: #28a745;
            color: white;
        }

        .overview-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            min-width: 100px;
            text-align: center;
            display: inline-block;
        }

        .overview-badge.total {
            background: #6c757d;
            color: white;
        }

        .overview-badge.all-day {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .overview-badge.scheduled {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .status-selector {
            position: relative;
            display: inline-block;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            min-width: 120px;
            text-align: center;
            display: inline-block;
            line-height: 1.5;
            box-sizing: border-box;
            height: 32px;
            vertical-align: middle;
        }

        .status-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .status-badge.pending {
            background: #ffc107;
            color: #333;
        }

        .status-badge.in-progress {
            background: #17a2b8;
            color: white;
        }

        .status-badge.completed {
            background: #28a745;
            color: white;
        }

        .status-badge.cancelled {
            background: #6c757d;
            color: white;
        }

        .status-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 5px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 150px;
            display: none;
        }

        .status-dropdown.show {
            display: block;
        }

        .status-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.9em;
            font-weight: 600;
        }

        .status-option:hover {
            background: #f8f9fa;
        }

        .task-description {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
            color: #495057;
            line-height: 1.6;
        }

        .subtasks-list {
            margin-top: 10px;
            padding: 12px 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .subtasks-header {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .subtask-item {
            padding: 5px 0 5px 20px;
            color: #495057;
            font-size: 0.9em;
            position: relative;
            line-height: 1.4;
        }

        .subtask-item::before {
            content: '';
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }

        .current-time-indicator {
            position: relative;
            height: 4px;
            background: linear-gradient(90deg, transparent 0%, #dc3545 10%, #dc3545 90%, transparent 100%);
            margin: 25px 0;
            border-radius: 2px;
            box-shadow: 0 0 15px rgba(220, 53, 69, 0.6);
            animation: pulse 10s infinite;
            z-index: 0;
        }

        .current-time-indicator.no-animation {
            animation: none;
        }

        .current-time-indicator::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 14px;
            height: 14px;
            background: #dc3545;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 15px rgba(220, 53, 69, 0.9);
            z-index: 10;
            animation: pulseCircle 10s infinite;
        }

        .current-time-indicator.no-animation::before {
            animation: none;
        }

        /* Only show time label on standalone indicators (not passing through cards) */
        .current-time-indicator[data-time]::after {
            content: attr(data-time);
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 700;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4);
            z-index: 10;
        }

        /* Hide the time label when line passes through a card */
        .task-card.current .current-time-indicator::after {
            display: none;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                box-shadow: 0 0 15px rgba(220, 53, 69, 0.6);
            }
            50% {
                opacity: 0.8;
                box-shadow: 0 0 25px rgba(220, 53, 69, 0.8);
            }
        }

        @keyframes pulseCircle {
            0%, 100% {
                transform: translateY(-50%) scale(1);
            }
            50% {
                transform: translateY(-50%) scale(1.2);
            }
        }

        .task-card.past {
            opacity: 0.65;
        }

        .task-card.current {
            border: 3px solid #dc3545;
            box-shadow: 0 4px 20px rgba(220, 53, 69, 0.4);
            animation: highlight 10s infinite;
            background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
        }

        .task-card.current.no-animation {
            animation: none;
        }

        .task-card.current::before {
            content: ' ' attr(data-current-time);
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #dc3545;
            color: white;
            padding: 6px 15px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: 0 3px 10px rgba(220, 53, 69, 0.5);
            z-index: 10;
        }

        /* Remove the after pseudo-element that was showing time on left */
        .task-card.current::after {
            display: none;
        }

        @keyframes highlight {
            0%, 100% {
                box-shadow: 0 4px 20px rgba(220, 53, 69, 0.4);
            }
            50% {
                box-shadow: 0 6px 30px rgba(220, 53, 69, 0.6);
            }
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
        }

        .success-message {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            color: #155724;
            animation: slideIn 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .success-message .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #155724;
            padding: 0 10px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .no-tasks {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .no-tasks h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .header h1 {
                font-size: 1.6em;
            }

            .content {
                padding: 15px;
            }

            .stats {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .search-filter-section {
                flex-direction: column;
            }

            .input-group {
                min-width: 100%;
            }

            .metrics-section {
                padding: 0;
            }

            .metrics-header {
                padding: 15px;
            }

            .metrics-content {
                padding: 0 15px 15px 15px;
            }

            .metrics-header h3 {
                font-size: 1.2em;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .metric-card-wide {
                grid-column: 1;
            }

            .employee-metrics {
                grid-template-columns: 1fr;
            }

            .matrix-section {
                padding: 15px;
            }

            .matrix-section h4 {
                font-size: 1em;
            }

            .matrix-grid {
                margin: 0 -15px;
                padding: 0 15px;
            }

            .matrix-table {
                font-size: 0.85em;
            }

            .matrix-table th,
            .matrix-table td {
                padding: 8px 4px;
            }

            .priority-badge {
                font-size: 0.75em;
                padding: 2px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="clock" id="clock">Loading...</div>
            <div class="current-date" id="currentDate">Loading...</div>
        </div>

        <div class="controls">
            <div class="control-section" id="fileUploadSection">
                <label> Load Database (.xlsx):</label>
                <div class="file-upload-area" id="dropArea" onclick="if(event.target.id !== 'excelFile') document.getElementById('excelFile').click()">
                    <div class="file-upload-icon"></div>
                    <div class="file-upload-text">
                        <strong>Click to browse</strong> or drag & drop your Spreadsheet file here
                    </div>
                    <div class="file-name-display" id="fileName"></div>
                    <input type="file" id="excelFile" accept=".xlsx,.xls" onclick="event.stopPropagation()" />
                </div>
            </div>

            <div class="search-filter-section">
                <div class="input-group">
                    <label for="searchBox"> Search Tasks</label>
                    <input type="text" id="searchBox" placeholder="Search by task name, description, or person..." onkeypress="if(event.key==='Enter')toggleSearchReset()">
                </div>
                <div class="input-group">
                    <label for="dateFilter"> View Date</label>
                    <input type="date" id="dateFilter" autocomplete="new-password" autocorrect="off" spellcheck="false" data-no-autofill="true">
                </div>
                <div class="input-group">
                    <label for="priorityFilter"> Priority</label>
                    <select id="priorityFilter">
                        <option value="">All Priorities</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="statusFilter"> Status</label>
                    <select id="statusFilter">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
            </div>

            <div class="available-dates" id="availableDates">
                <div class="available-dates-label"> Dates with tasks:</div>
                <div class="date-chips" id="dateChips">
                    <div class="no-dates-message">No tasks loaded yet</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-success" onclick="exportToExcel()"> Export Report</button>
                <button class="btn btn-warning" onclick="exportForTV()" id="exportTVButton" style="display: none;"> Export for TV</button>
                <a class="btn btn-info" href="https://github.com/MohsenUSA/TaskManager/raw/refs/heads/main/Database.xlsx" target="_blank"> Download Template</a>
                <button class="btn btn-danger" onclick="clearAllData()"> Clear Data</button>
                <button class="btn btn-primary" id="searchResetButton" onclick="toggleSearchReset()"> Search</button>
            </div>
        </div>

        <div class="content">
            <div class="demo-note" id="demoNote">
                <div class="demo-note-header" onclick="toggleGettingStarted()">
                    <h4> Getting Started</h4>
                    <button class="demo-note-toggle" id="gettingStartedToggle"></button>
                </div>
                <div class="demo-note-content collapsed" id="gettingStartedContent">
                    <p><strong>Welcome to your task management system!</strong></p>

                    <p><strong> Getting Started:</strong></p>
                    <ul>
                        <li> <strong>Download Template</strong> - Click the button above to get Database.xlsx</li>
                        <li> <strong>Add Your Data</strong> - Fill in Tasks, Employees, and TaskTemplates sheets</li>
                        <li> <strong>Upload File</strong> - Drag & drop your Spreadsheet file into the upload area above</li>
                        <li> <strong>Start Managing</strong> - Tasks load instantly and auto-save to your browser</li>
                    </ul>

                    <p><strong> Key Features:</strong></p>
                    <ul>
                        <li> <strong>All-Day Tasks</strong> - Leave Time blank for tasks that span the entire day (appear in sticky blue section at top)</li>
                        <li> <strong>Everyday Tasks</strong> - Leave Date blank for tasks that appear on ALL dates (great for daily reminders)</li>
                        <li> <strong>Timed Tasks</strong> - Add specific times for scheduled activities (sorted chronologically below all-day tasks)</li>
                        <li> <strong>Real-time Indicator</strong> - Red line shows current time position with automatic highlighting</li>
                        <li> <strong>Smart Assignment</strong> - Click "Everyone" to assign tasks to team members</li>
                        <li> <strong>Quick Status Updates</strong> - Click any status badge to change task progress</li>
                        <li> <strong>Advanced Search</strong> - Filter by employee, status, priority, or custom text</li>
                        <li> <strong>Live Analytics</strong> - Real-time metrics and priority  status breakdowns</li>
                    </ul>

                    <p><strong> Spreadsheet Structure:</strong></p>
                    <ul>
                        <li><strong>Tasks Sheet:</strong> Date (MM-DD-YYYY or blank for everyday), Time (h:mm AM/PM or blank for all-day), Task, Description, Priority (High/Medium/Low), Assigned, Status</li>
                        <li><strong>Employees Sheet:</strong> Name (team member list for assignments)</li>
                        <li><strong>TaskTemplates Sheet:</strong> TaskName, Description (optional - for reusable templates)</li>
                        <li><strong>Note:</strong> First 2 rows in Tasks sheet are automatically skipped (reserved for instructions)</li>
                    </ul>

                    <p><strong> Pro Tips:</strong></p>
                    <ul>
                        <li><strong>All-Day Tasks:</strong> Perfect for deadlines, reminders, or flexible tasks - just leave Time column blank</li>
                        <li><strong>Everyday Tasks:</strong> Leave Date blank for recurring daily tasks - they appear on every date with a  icon</li>
                        <li><strong>Priority Sorting:</strong> All-day tasks automatically sort by priority (High  Medium  Low)</li>
                        <li><strong>Date Navigation:</strong> Click date chips at top to quickly jump between dates</li>
                        <li><strong>Floating Clock Button:</strong> Click  to scroll to current time, click  to return to top</li>
                        <li><strong>Auto-Save:</strong> All status changes save automatically to browser storage</li>
                        <li><strong>Export Report:</strong> Click " Export Report" to download updated tasks with metrics</li>
                        <li><strong>Export for TV:</strong> Click " Export for TV" (appears after loading data) to create a standalone HTML file with tasks embedded - perfect for TV displays, kiosks, or sharing without requiring Spreadsheet file uploads</li>
                        <li><strong>Timezone Safe:</strong> Dates are automatically localized to your timezone</li>
                    </ul>
                </div>
            </div>

            <div class="stats" id="stats">
                <div class="stat-card stat-total">
                    <h3 id="statTotal">0</h3>
                    <p>Total Tasks</p>
                </div>
                <div class="stat-card stat-allday">
                    <h3 id="statAllDay">0</h3>
                    <p>All Day</p>
                </div>
                <div class="stat-card stat-completed">
                    <h3 id="statCompleted">0</h3>
                    <p>Completed</p>
                </div>
                <div class="stat-card stat-progress">
                    <h3 id="statProgress">0</h3>
                    <p>In Progress</p>
                </div>
                <div class="stat-card stat-pending">
                    <h3 id="statPending">0</h3>
                    <p>Pending</p>
                </div>
            </div>

            <div class="metrics-section">
                <div class="metrics-header" onclick="toggleMetrics()">
                    <h3> Detailed Metrics</h3>
                    <button class="metrics-toggle" id="metricsToggleIcon"></button>
                </div>
                <div id="metricsContent" class="metrics-content collapsed">
                    <div class="metrics-grid">
                        <!-- Task Overview -->
                        <div class="metric-card">
                            <div class="metric-header">
                                <div class="metric-title"> Task Overview</div>
                            </div>
                            <div class="task-overview-breakdown">
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="overview-badge total"> Total Tasks</span>
                                    </span>
                                    <span class="metric-value" id="metricTotalTasks">0</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="overview-badge all-day"> All-Day</span>
                                    </span>
                                    <span class="metric-value" id="metricAllDayTasks">0</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="overview-badge scheduled"> Scheduled</span>
                                    </span>
                                    <span class="metric-value" id="metricTimedTasks">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Priority Breakdown -->
                        <div class="metric-card">
                            <div class="metric-header">
                                <div class="metric-title"> By Priority</div>
                            </div>
                            <div class="priority-breakdown">
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="priority-badge high"> High</span>
                                    </span>
                                    <span class="metric-value" id="metricHighPriority">0</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="priority-badge medium"> Medium</span>
                                    </span>
                                    <span class="metric-value" id="metricMediumPriority">0</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="priority-badge low"> Low</span>
                                    </span>
                                    <span class="metric-value" id="metricLowPriority">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Status Breakdown -->
                        <div class="metric-card">
                            <div class="metric-header">
                                <div class="metric-title"> By Status</div>
                            </div>
                            <div class="status-breakdown">
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="status-badge pending"> Pending</span>
                                    </span>
                                    <span class="metric-value" id="metricStatusPending">0</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="status-badge in-progress"> In Progress</span>
                                    </span>
                                    <span class="metric-value" id="metricStatusProgress">0</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">
                                        <span class="status-badge completed"> Completed</span>
                                    </span>
                                    <span class="metric-value" id="metricStatusCompleted">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Employee Assignment -->
                        <div class="metric-card metric-card-wide">
                            <div class="metric-header">
                                <div class="metric-title"> Tasks by Employee</div>
                            </div>
                            <div id="employeeMetrics" class="employee-metrics"></div>
                        </div>
                    </div>

                    <!-- Priority + Status Matrix -->
                    <div class="matrix-section">
                        <h4> Priority  Status Matrix</h4>
                        <div class="matrix-grid">
                            <table class="matrix-table">
                                <thead>
                                    <tr>
                                        <th>Priority</th>
                                        <th> Pending</th>
                                        <th> In Progress</th>
                                        <th> Completed</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="priority-badge high"> High</span></td>
                                        <td id="matrix-high-pending">0</td>
                                        <td id="matrix-high-progress">0</td>
                                        <td id="matrix-high-completed">0</td>
                                        <td id="matrix-high-total">0</td>
                                    </tr>
                                    <tr>
                                        <td><span class="priority-badge medium"> Medium</span></td>
                                        <td id="matrix-medium-pending">0</td>
                                        <td id="matrix-medium-progress">0</td>
                                        <td id="matrix-medium-completed">0</td>
                                        <td id="matrix-medium-total">0</td>
                                    </tr>
                                    <tr>
                                        <td><span class="priority-badge low"> Low</span></td>
                                        <td id="matrix-low-pending">0</td>
                                        <td id="matrix-low-progress">0</td>
                                        <td id="matrix-low-completed">0</td>
                                        <td id="matrix-low-total">0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tasks-container" id="tasksContainer">
                <div class="tasks-header">
                    <span id="tasksHeaderText">Tasks for Today</span>
                    <span class="task-count" id="taskCount">0 tasks</span>
                </div>
                <div id="tasksList"></div>
            </div>
        </div>
    </div>

    <!-- Floating anchor to current time -->
    <div class="floating-anchor" id="floatingAnchor" onclick="toggleCurrentTime()" title="Go to current time">
        <span class="floating-anchor-icon" id="anchorIcon"></span>
        <div class="floating-anchor-tooltip" id="anchorTooltip">Go to current time</div>
    </div>

    <script>
        // ============================================
        // ANIMATION SETTINGS (Easy Configuration)
        // ============================================
        // Controls heartbeat/pulse animations for:
        // - Current time indicator line (red line)
        // - Red circle indicator
        // - Current task card highlight
        //
        // ENABLE_ANIMATIONS: Set to false to turn off all animations
        // ANIMATION_INTERVAL: Change duration (e.g., '2s', '5s', '10s', '30s')
        // ============================================
        const ENABLE_ANIMATIONS = true;        // Set to false to disable all animations
        const ANIMATION_INTERVAL = '10s';      // Animation cycle duration (e.g., '2s', '5s', '10s')
        // ============================================

        let allTasks = [];
        let taskTemplates = [];
        let employees = [];
        let currentFilterDate = null;
        let filteredTasks = [];
        let isAtCurrentTime = false;
        let autoFollowInterval = null;
        let isSearchActive = false;
        const STORAGE_KEY = 'excelTaskCalendarFullDay';

        // Helper function to get local date in YYYY-MM-DD format (timezone-safe)
        function getLocalDateString(date = new Date()) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Helper function to format date as MM-DD-YYYY for CSV export
        function formatDateForCSV(dateStr) {
            if (!dateStr) return '';
            // dateStr is in YYYY-MM-DD format
            const parts = dateStr.split('-');
            if (parts.length !== 3) return dateStr;
            const [year, month, day] = parts;
            return `${month}-${day}-${year}`;
        }

        // Initialize empty data arrays
        function createDemoData() {
            allTasks = [];
            taskTemplates = [];
            employees = [];
        }

        // Real-time clock
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const clockEl = document.getElementById('clock');
            const dateEl = document.getElementById('currentDate');
            if (clockEl) clockEl.textContent = ' ' + timeString;
            if (dateEl) dateEl.textContent = dateString;
        }

        // Clock and minute update intervals will be started after DOM loads
        let clockInterval = null;
        let minuteInterval = null;

        function setTodayDate() {
            const today = getLocalDateString();
            const dateInput = document.getElementById('dateFilter');
            if (dateInput) {
                dateInput.value = today;
                currentFilterDate = today;
            }
        }

        function saveToLocalStorage() {
            const data = { tasks: allTasks, templates: taskTemplates, employees: employees };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (data) {
                const parsed = JSON.parse(data);
                allTasks = parsed.tasks || [];
                taskTemplates = parsed.templates || [];
                employees = parsed.employees || [];
                return true;
            }
            return false;
        }

        function updateTaskStatus(taskId, newStatus) {
            const task = allTasks.find(t => t.id === taskId);
            if (task) {
                task.Status = newStatus;
                saveToLocalStorage();
                updateAvailableDates();
                applyFilters();
                showSuccessMessage('Status updated! Export Report to save changes.');
            }
        }

        function showToday() {
            const today = getLocalDateString();
            const dateInput = document.getElementById('dateFilter');

            // Force reset the date input
            dateInput.value = '';
            dateInput.setAttribute('value', today);
            dateInput.value = today;
            currentFilterDate = today;

            // Clear other filters but keep the date
            document.getElementById('searchBox').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('statusFilter').value = '';
            applyFilters();
        }

        function toggleSearchReset() {
            if (isSearchActive) {
                // Currently in search mode, reset everything
                const today = getLocalDateString();
                const dateInput = document.getElementById('dateFilter');

                // Force reset the date input
                dateInput.value = '';
                dateInput.setAttribute('value', today);
                dateInput.value = today;
                currentFilterDate = today;

                document.getElementById('searchBox').value = '';
                document.getElementById('priorityFilter').value = '';
                document.getElementById('statusFilter').value = '';

                isSearchActive = false;
                updateSearchButton();
                applyFilters();
            } else {
                // Apply search
                isSearchActive = true;
                updateSearchButton();
                applyFilters();
            }
        }

        function updateSearchButton() {
            const button = document.getElementById('searchResetButton');
            if (isSearchActive) {
                button.textContent = ' Reset';
                button.className = 'btn btn-warning';
            } else {
                button.textContent = ' Search';
                button.className = 'btn btn-primary';
            }
        }

        function clearFilters() {
            // Reset to today's date and clear all other filters
            const today = getLocalDateString();
            const dateInput = document.getElementById('dateFilter');

            // Force reset the date input
            dateInput.value = '';
            dateInput.setAttribute('value', today);
            dateInput.value = today;
            currentFilterDate = today;

            document.getElementById('searchBox').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('statusFilter').value = '';

            isSearchActive = false;
            updateSearchButton();
            applyFilters();
        }

        function filterByDate() {
            const selectedDate = document.getElementById('dateFilter').value;

            // Validate the date and prevent empty or invalid dates
            if (!selectedDate) {
                const today = getLocalDateString();
                document.getElementById('dateFilter').value = today;
                currentFilterDate = today;
            } else {
                currentFilterDate = selectedDate;
            }

            applyFilters();
            updateDateChips();
        }

        function updateAvailableDates() {
            if (allTasks.length === 0) {
                document.getElementById('dateChips').innerHTML = '<div class="no-dates-message">No tasks loaded yet</div>';
                return;
            }

            // Get unique dates from all tasks
            const uniqueDates = [...new Set(allTasks.map(task => task.normalizedDate).filter(date => date))];
            uniqueDates.sort();

            if (uniqueDates.length === 0) {
                document.getElementById('dateChips').innerHTML = '<div class="no-dates-message">No valid dates found</div>';
                return;
            }

            // Count everyday tasks (no date = appears on all dates)
            const everydayTaskCount = allTasks.filter(t => t.isEveryday).length;

            // Create date chips
            const dateChipsHTML = uniqueDates.map(date => {
                const dateObj = new Date(date + 'T00:00:00');
                const displayDate = dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const dateSpecificCount = allTasks.filter(t => t.normalizedDate === date).length;
                const taskCount = dateSpecificCount + everydayTaskCount;
                const isActive = date === currentFilterDate ? 'active' : '';
                return `<div class="date-chip ${isActive}" onclick="selectDate('${date}')">${displayDate} (${taskCount})</div>`;
            }).join('');

            document.getElementById('dateChips').innerHTML = dateChipsHTML;
        }

        function updateDateChips() {
            // Update active state of date chips
            const chips = document.querySelectorAll('.date-chip');
            chips.forEach(chip => {
                chip.classList.remove('active');
            });

            const uniqueDates = [...new Set(allTasks.map(task => task.normalizedDate).filter(date => date))];
            const activeIndex = uniqueDates.indexOf(currentFilterDate);
            if (activeIndex >= 0 && chips[activeIndex]) {
                chips[activeIndex].classList.add('active');
            }
        }

        function selectDate(date) {
            console.log('selectDate - Selecting date:', date);
            const dateInput = document.getElementById('dateFilter');

            // Force set the date
            dateInput.value = '';
            dateInput.setAttribute('value', date);
            dateInput.value = date;
            currentFilterDate = date;

            // Clear only search filters, NOT the date
            document.getElementById('searchBox').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('statusFilter').value = '';

            console.log('selectDate - currentFilterDate set to:', currentFilterDate);
            console.log('selectDate - dateFilter value:', dateInput.value);

            applyFilters();
            updateDateChips();
        }

        function applyFilters() {
            // Only apply search criteria if search is active
            const searchTerm = isSearchActive ? document.getElementById('searchBox').value.toLowerCase() : '';
            const priorityFilter = isSearchActive ? document.getElementById('priorityFilter').value.toLowerCase() : '';
            const statusFilter = isSearchActive ? document.getElementById('statusFilter').value.toLowerCase() : '';

            console.log('applyFilters - isSearchActive:', isSearchActive);
            console.log('applyFilters - currentFilterDate:', currentFilterDate);
            console.log('applyFilters - dateFilter input value:', document.getElementById('dateFilter').value);
            console.log('applyFilters - Total tasks:', allTasks.length);

            filteredTasks = allTasks.filter(task => {
                // Match date OR include everyday tasks (no date = appears on all dates)
                const matchesDate = task.normalizedDate === currentFilterDate || task.isEveryday;

                // Only apply search filters if search is active
                const matchesSearch = !searchTerm ||
                    (task.Task && task.Task.toLowerCase().includes(searchTerm)) ||
                    (task.Description && task.Description.toLowerCase().includes(searchTerm)) ||
                    (task.Assigned && task.Assigned.toLowerCase().includes(searchTerm));
                const matchesPriority = !priorityFilter ||
                    (task.Priority && task.Priority.toLowerCase() === priorityFilter);
                const matchesStatus = !statusFilter ||
                    (task.Status && task.Status.toLowerCase().replace(' ', '-') === statusFilter);

                return matchesDate && matchesSearch && matchesPriority && matchesStatus;
            });

            console.log('applyFilters - Filtered tasks count:', filteredTasks.length);
            console.log('applyFilters - Sample task dates:', allTasks.slice(0, 3).map(t => t.normalizedDate));

            displayTasks();
            updateDateChips();
        }

        function convertTo24Hour(timeStr) {
            if (!timeStr) return '00:00';

            const match = timeStr.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?/i);
            if (!match) return timeStr;

            let hours = parseInt(match[1]);
            const minutes = match[2];
            const period = match[3];

            if (period) {
                if (period.toUpperCase() === 'PM' && hours !== 12) {
                    hours += 12;
                } else if (period.toUpperCase() === 'AM' && hours === 12) {
                    hours = 0;
                }
            }

            return `${String(hours).padStart(2, '0')}:${minutes}`;
        }

        function renderSubtasks(subtasks) {
            if (!subtasks || subtasks.length === 0) return '';
            const subtaskItems = subtasks.map(st => `<div class="subtask-item">${st}</div>`).join('');
            return `
                <div class="subtasks-list">
                    <div class="subtasks-header"> Subtasks:</div>
                    ${subtaskItems}
                </div>
            `;
        }

        function renderAssignees(assignees, taskId) {
            if (!assignees || assignees.length === 0) return '';

            const isAllTeam = assignees.length === 1 && assignees[0].toLowerCase() === 'everyone';
            const icon = assignees.length > 1 ? '' : '';

            if (isAllTeam) {
                return `
                    <div class="task-meta-item assignees-container">
                        <strong>${icon}</strong>
                        <span class="assignee-badge all-team clickable" onclick="openAssigneeSelector(event, '${taskId}')" title="Click to change assignees">Everyone</span>
                    </div>
                `;
            }

            const badges = assignees.map(name =>
                `<span class="assignee-badge assigned clickable" onclick="openAssigneeSelector(event, '${taskId}')" title="Click to change assignees">${name}</span>`
            ).join('');

            return `
                <div class="task-meta-item assignees-container">
                    <strong>${icon}</strong>
                    ${badges}
                </div>
            `;
        }

        function openAssigneeSelector(event, taskId) {
            event.stopPropagation();

            const task = allTasks.find(t => t.id === taskId);
            if (!task) return;

            // Get employee list from loaded data, or use current assignees as fallback
            const employeeList = employees.length > 0
                ? employees.map(e => e.Name || e.name || Object.values(e)[0]).filter(n => n)
                : [];

            // Add "Everyone" option at the top
            const allOptions = ['Everyone', ...employeeList.filter(e => e.toLowerCase() !== 'everyone')];

            // Remove any existing selector
            const existingSelector = document.getElementById('assigneeSelector');
            if (existingSelector) {
                existingSelector.remove();
            }

            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.id = 'assigneeSelector';
            overlay.className = 'employee-selector-overlay';
            overlay.onclick = function(e) {
                if (e.target === overlay) {
                    overlay.remove();
                }
            };

            // Create modal content
            const modal = document.createElement('div');
            modal.className = 'employee-selector-modal';
            modal.onclick = function(e) {
                e.stopPropagation();
            };

            // Add header
            const header = document.createElement('div');
            header.className = 'employee-selector-header';
            header.innerHTML = '<h3> Select Assignees</h3><button class="close-modal" onclick="document.getElementById(\'assigneeSelector\').remove()"></button>';
            modal.appendChild(header);

            // Add instruction
            const instruction = document.createElement('div');
            instruction.style.cssText = 'padding: 10px 15px; color: #6c757d; font-size: 0.9em; border-bottom: 1px solid #e9ecef;';
            instruction.textContent = 'Click to select/deselect. Multiple selections allowed.';
            modal.appendChild(instruction);

            // Track selected assignees
            let selectedAssignees = [...(task.assignees || ['Everyone'])];

            // Add employee list with checkboxes
            const listContainer = document.createElement('div');
            listContainer.className = 'employee-selector-list';

            allOptions.forEach(employeeName => {
                const item = document.createElement('div');
                item.className = 'employee-selector-item';
                const isSelected = selectedAssignees.some(a => a.toLowerCase() === employeeName.toLowerCase());
                if (isSelected) item.classList.add('selected');

                item.innerHTML = `
                    <span class="employee-checkbox">${isSelected ? '' : ''}</span>
                    <span class="employee-icon"></span>
                    <span class="employee-name-text">${employeeName}</span>
                `;

                item.onclick = function() {
                    const checkbox = item.querySelector('.employee-checkbox');
                    const nameText = employeeName;

                    if (nameText.toLowerCase() === 'everyone') {
                        // If selecting Everyone, clear others
                        selectedAssignees = ['Everyone'];
                        listContainer.querySelectorAll('.employee-selector-item').forEach(el => {
                            el.classList.remove('selected');
                            el.querySelector('.employee-checkbox').textContent = '';
                        });
                        item.classList.add('selected');
                        checkbox.textContent = '';
                    } else {
                        // Remove Everyone if selecting specific person
                        const everyoneIdx = selectedAssignees.findIndex(a => a.toLowerCase() === 'everyone');
                        if (everyoneIdx > -1) {
                            selectedAssignees.splice(everyoneIdx, 1);
                            const everyoneItem = listContainer.querySelector('.employee-selector-item');
                            if (everyoneItem) {
                                everyoneItem.classList.remove('selected');
                                everyoneItem.querySelector('.employee-checkbox').textContent = '';
                            }
                        }

                        const idx = selectedAssignees.findIndex(a => a.toLowerCase() === nameText.toLowerCase());
                        if (idx > -1) {
                            // Deselect
                            selectedAssignees.splice(idx, 1);
                            item.classList.remove('selected');
                            checkbox.textContent = '';
                        } else {
                            // Select
                            selectedAssignees.push(nameText);
                            item.classList.add('selected');
                            checkbox.textContent = '';
                        }

                        // If nothing selected, default to Everyone
                        if (selectedAssignees.length === 0) {
                            selectedAssignees = ['Everyone'];
                            const everyoneItem = listContainer.querySelector('.employee-selector-item');
                            if (everyoneItem) {
                                everyoneItem.classList.add('selected');
                                everyoneItem.querySelector('.employee-checkbox').textContent = '';
                            }
                        }
                    }
                };

                listContainer.appendChild(item);
            });

            modal.appendChild(listContainer);

            // Add confirm button
            const confirmBtn = document.createElement('button');
            confirmBtn.className = 'confirm-assignees-btn';
            confirmBtn.textContent = ' Confirm';
            confirmBtn.onclick = function() {
                updateTaskAssignees(taskId, selectedAssignees);
                overlay.remove();
            };
            modal.appendChild(confirmBtn);

            overlay.appendChild(modal);
            document.body.appendChild(overlay);
        }

        function updateTaskAssignees(taskId, assignees) {
            const task = allTasks.find(t => t.id === taskId);
            if (task) {
                const oldAssignees = task.assignees.join(', ');
                task.assignees = assignees;
                task.Assigned = assignees.join(', ');
                saveToLocalStorage();
                applyFilters();
                showSuccessMessage(`Assignees updated: "${oldAssignees}"  "${assignees.join(', ')}"`);
            }
        }

        function displayTasks() {
            // Separate all-day tasks from timed tasks
            const allDayTasks = filteredTasks.filter(task => task.isAllDay);
            const timedTasks = filteredTasks.filter(task => !task.isAllDay);

            // Sort all-day tasks by priority (High -> Medium -> Low)
            const priorityOrder = { 'high': 1, 'medium': 2, 'low': 3 };
            allDayTasks.sort((a, b) => {
                const priorityA = priorityOrder[(a.Priority || 'low').toLowerCase()] || 3;
                const priorityB = priorityOrder[(b.Priority || 'low').toLowerCase()] || 3;
                return priorityA - priorityB;
            });

            // Sort timed tasks by time
            timedTasks.sort((a, b) => {
                const timeA = convertTo24Hour(a.Time || '00:00');
                const timeB = convertTo24Hour(b.Time || '00:00');
                return timeA.localeCompare(timeB);
            });

            // Combine: all-day tasks first, then timed tasks
            filteredTasks = [...allDayTasks, ...timedTasks];

            const allTasksForDate = allTasks.filter(task => task.normalizedDate === currentFilterDate || task.isEveryday);
            const stats = {
                total: allTasksForDate.length,
                allDay: allTasksForDate.filter(t => t.isAllDay).length,
                completed: allTasksForDate.filter(t => t.Status?.toLowerCase() === 'completed').length,
                progress: allTasksForDate.filter(t => t.Status?.toLowerCase() === 'in progress').length,
                pending: allTasksForDate.filter(t => t.Status?.toLowerCase() === 'pending' && !t.isAllDay).length
            };

            document.getElementById('statTotal').textContent = stats.total;
            document.getElementById('statAllDay').textContent = stats.allDay;
            document.getElementById('statCompleted').textContent = stats.completed;
            document.getElementById('statProgress').textContent = stats.progress;
            document.getElementById('statPending').textContent = stats.pending;

            // Update detailed metrics
            updateMetrics(allTasksForDate);

            const filterDateObj = new Date(currentFilterDate + 'T00:00:00');
            const dateString = filterDateObj.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('tasksHeaderText').textContent = `Tasks for ${dateString}`;
            document.getElementById('taskCount').textContent = `${filteredTasks.length} task${filteredTasks.length !== 1 ? 's' : ''}`;

            const tasksList = document.getElementById('tasksList');
            const now = new Date();
            const currentTime24 = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            const isToday = currentFilterDate === getLocalDateString();
            
            if (filteredTasks.length === 0) {
                tasksList.innerHTML = `
                    <div class="no-tasks">
                        <h3> No tasks found</h3>
                        <p>Try adjusting your filters or add tasks in your Spreadsheet file</p>
                    </div>
                `;
                return;
            }

            let allDayTasksHTML = '';
            let timedTasksHTML = '';
            let currentTaskFound = false;
            let timeIndicatorShown = false;

            // Render All-Day Tasks Section
            if (allDayTasks.length > 0) {
                allDayTasksHTML = '<div class="all-day-tasks-section"><div class="all-day-header"> All-Day Tasks</div><div class="all-day-tasks-container">';

                allDayTasks.forEach((task) => {
                    const priority = task.hasPriority ? task.Priority.toLowerCase() : '';
                    const status = task.hasStatus ? task.Status.toLowerCase().replace(' ', '-') : '';
                    const description = `<div class="task-description">${task.Description || ''}</div>`;
                    const subtasksHTML = renderSubtasks(task.subtasks);
                    const assigneesHTML = renderAssignees(task.assignees, task.id);
                    const statusOptions = ['Pending', 'In Progress', 'Completed'];
                    const currentStatus = task.Status || '';
                    const everydayIcon = task.isEveryday ? '<span class="everyday-icon" title="Everyday task - appears on all dates"></span>' : '';
                    const priorityClass = task.hasPriority ? `priority-${priority}` : '';
                    const statusClass = task.hasStatus ? `status-${status}` : '';

                    allDayTasksHTML += `
                        <div class="task-card all-day ${priorityClass} ${statusClass}" style="position: relative;">
                            ${everydayIcon}
                            <div style="position: relative; z-index: 5; background: white; padding: 10px; margin: -10px;">
                                <div class="task-header">
                                    <div class="task-title">${task.Task || 'Untitled Task'}</div>
                                    <div class="task-time all-day"> All Day</div>
                                </div>
                                <div class="task-meta">
                                    ${task.hasPriority ? `
                                    <div class="task-meta-item">
                                        <span class="priority-badge ${priority}">
                                            ${priority === 'high' ? '' : priority === 'medium' ? '' : ''}
                                            ${task.Priority}
                                        </span>
                                    </div>
                                    ` : ''}
                                    ${task.hasStatus ? `
                                    <div class="status-selector">
                                        <span class="status-badge ${status}" onclick="toggleStatusDropdown(event, '${task.id}')">
                                            ${status === 'pending' ? '' : status === 'in-progress' ? '' : status === 'completed' ? '' : ''}
                                            ${currentStatus}
                                        </span>
                                        <div class="status-dropdown" id="dropdown-${task.id}">
                                            ${statusOptions.map(opt => `
                                                <div class="status-option" onclick="updateTaskStatus('${task.id}', '${opt}')">${opt}</div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                    ${assigneesHTML}
                                </div>
                                ${description}
                                ${subtasksHTML}
                            </div>
                        </div>
                    `;
                });

                allDayTasksHTML += '</div></div>';
            }

            // Render Timed Tasks Section
            if (timedTasks.length > 0) {
                timedTasks.forEach((task, index) => {
                    const priority = task.hasPriority ? task.Priority.toLowerCase() : '';
                    const status = task.hasStatus ? task.Status.toLowerCase().replace(' ', '-') : '';
                    const description = task.Description ?
                        `<div class="task-description">${task.Description}</div>` : '';
                    const subtasksHTML = renderSubtasks(task.subtasks);
                    const priorityClass = task.hasPriority ? `priority-${priority}` : '';
                    const statusClass = task.hasStatus ? `status-${status}` : '';

                    const taskTime = task.Time || '00:00 AM';
                    const taskTime24 = convertTo24Hour(taskTime);

                    let taskClass = '';
                    let showIndicatorBefore = false;
                    let isCurrentTask = false;

                    if (isToday) {
                        const [hours, minutes] = taskTime24.split(':').map(Number);
                        const taskEndMinutes = hours * 60 + minutes + 30;
                        const taskEndHours = Math.floor(taskEndMinutes / 60);
                        const taskEndMins = taskEndMinutes % 60;
                        const taskEndTime = `${String(taskEndHours).padStart(2, '0')}:${String(taskEndMins).padStart(2, '0')}`;

                        if (taskTime24 < currentTime24 && taskEndTime < currentTime24) {
                            taskClass = 'past';
                        } else if (taskTime24 <= currentTime24 && currentTime24 <= taskEndTime) {
                            taskClass = 'current';
                            currentTaskFound = true;
                            isCurrentTask = true;
                            timeIndicatorShown = true;
                        }

                        // Show indicator before first future task if we haven't found current task
                        if (!timeIndicatorShown && !currentTaskFound && taskTime24 > currentTime24) {
                            showIndicatorBefore = true;
                            timeIndicatorShown = true;
                        }
                    }

                    // Add current time indicator BEFORE this task if needed
                    if (showIndicatorBefore && isToday) {
                        const animClass = ENABLE_ANIMATIONS ? '' : ' no-animation';
                        timedTasksHTML += `<div class="current-time-indicator${animClass}" data-time=" Current Time: ${now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}"></div>`;
                    }

                    const statusOptions = ['Pending', 'In Progress', 'Completed'];
                    const currentStatus = task.Status || '';
                    const assigneesHTML = renderAssignees(task.assignees, task.id);
                    const animClass = (!ENABLE_ANIMATIONS && taskClass === 'current') ? ' no-animation' : '';
                    const everydayIcon = task.isEveryday ? '<span class="everyday-icon" title="Everyday task - appears on all dates"></span>' : '';

                    timedTasksHTML += `
                        <div class="task-card ${priorityClass} ${statusClass} ${taskClass}${animClass}" ${isCurrentTask ? `data-current-time="Current Time: ${now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}"` : ''} style="position: relative;">
                            ${everydayIcon}
                            ${isCurrentTask ? `
                                <div class="current-time-indicator${ENABLE_ANIMATIONS ? '' : ' no-animation'}" style="position: absolute; top: 50%; left: -20px; right: -20px; transform: translateY(-50%); margin: 0; z-index: 0;"></div>
                            ` : ''}
                            <div style="position: relative; z-index: 5; background: white; padding: 10px; margin: -10px;">
                                <div class="task-header">
                                    <div class="task-title">${task.Task || 'Untitled Task'}</div>
                                    <div class="task-time"> ${task.Time}</div>
                                </div>
                                <div class="task-meta">
                                    ${task.hasPriority ? `
                                    <div class="task-meta-item">
                                        <span class="priority-badge ${priority}">
                                            ${priority === 'high' ? '' : priority === 'medium' ? '' : ''}
                                            ${task.Priority}
                                        </span>
                                    </div>
                                    ` : ''}
                                    ${task.hasStatus ? `
                                    <div class="status-selector">
                                        <span class="status-badge ${status}" onclick="toggleStatusDropdown(event, '${task.id}')">
                                            ${status === 'pending' ? '' : status === 'in-progress' ? '' : status === 'completed' ? '' : ''}
                                            ${currentStatus}
                                        </span>
                                        <div class="status-dropdown" id="dropdown-${task.id}">
                                            ${statusOptions.map(opt => `
                                                <div class="status-option" onclick="updateTaskStatus('${task.id}', '${opt}')">${opt}</div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                    ${assigneesHTML}
                                </div>
                                ${description}
                                ${subtasksHTML}
                            </div>
                        </div>
                    `;
                });

                // If all timed tasks are in the future, show indicator at the top
                if (isToday && !timeIndicatorShown && timedTasks.length > 0) {
                    const firstTaskTime24 = convertTo24Hour(timedTasks[0].Time || '00:00 AM');
                    if (firstTaskTime24 > currentTime24) {
                        const animClass = ENABLE_ANIMATIONS ? '' : ' no-animation';
                        timedTasksHTML = `<div class="current-time-indicator${animClass}" data-time=" Current Time: ${now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}"></div>` + timedTasksHTML;
                        timeIndicatorShown = true;
                    }
                }

                // If all timed tasks are in the past, show indicator at the bottom
                if (isToday && !timeIndicatorShown && timedTasks.length > 0) {
                    const lastTaskTime24 = convertTo24Hour(timedTasks[timedTasks.length - 1].Time || '00:00 AM');
                    if (lastTaskTime24 < currentTime24) {
                        const animClass = ENABLE_ANIMATIONS ? '' : ' no-animation';
                        timedTasksHTML += `<div class="current-time-indicator${animClass}" data-time=" Current Time: ${now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}"></div>`;
                    }
                }
            }

            tasksList.innerHTML = allDayTasksHTML + timedTasksHTML;
        }

        function updateMetrics(tasks) {
            // Task overview counts
            const totalTasks = tasks.length;
            const allDayTasks = tasks.filter(t => t.isAllDay).length;
            const timedTasks = tasks.filter(t => !t.isAllDay).length;

            document.getElementById('metricTotalTasks').textContent = totalTasks;
            document.getElementById('metricAllDayTasks').textContent = allDayTasks;
            document.getElementById('metricTimedTasks').textContent = timedTasks;

            // Priority counts
            const highPriority = tasks.filter(t => t.Priority?.toLowerCase() === 'high').length;
            const mediumPriority = tasks.filter(t => t.Priority?.toLowerCase() === 'medium').length;
            const lowPriority = tasks.filter(t => t.Priority?.toLowerCase() === 'low').length;

            document.getElementById('metricHighPriority').textContent = highPriority;
            document.getElementById('metricMediumPriority').textContent = mediumPriority;
            document.getElementById('metricLowPriority').textContent = lowPriority;

            // Status counts
            const pending = tasks.filter(t => t.Status?.toLowerCase() === 'pending').length;
            const inProgress = tasks.filter(t => t.Status?.toLowerCase() === 'in progress').length;
            const completed = tasks.filter(t => t.Status?.toLowerCase() === 'completed').length;

            document.getElementById('metricStatusPending').textContent = pending;
            document.getElementById('metricStatusProgress').textContent = inProgress;
            document.getElementById('metricStatusCompleted').textContent = completed;

            // Employee metrics (count each assignee separately for multi-assignee tasks)
            const employeeCounts = {};
            tasks.forEach(task => {
                const assignees = task.assignees && task.assignees.length > 0 ? task.assignees : ['Unassigned'];
                assignees.forEach(employee => {
                    if (employee.toLowerCase() !== 'everyone') {
                        employeeCounts[employee] = (employeeCounts[employee] || 0) + 1;
                    }
                });
            });

            const sortedEmployees = Object.entries(employeeCounts).sort((a, b) => b[1] - a[1]);
            const employeeMetricsHTML = sortedEmployees.map(([name, count]) => `
                <div class="employee-metric-item">
                    <span class="employee-name"> ${name}</span>
                    <span class="employee-task-count">${count}</span>
                </div>
            `).join('');

            document.getElementById('employeeMetrics').innerHTML = employeeMetricsHTML;

            // Priority  Status Matrix
            const matrix = {
                high: { pending: 0, progress: 0, completed: 0 },
                medium: { pending: 0, progress: 0, completed: 0 },
                low: { pending: 0, progress: 0, completed: 0 }
            };

            tasks.forEach(task => {
                const priority = (task.Priority || 'low').toLowerCase();
                const status = task.Status?.toLowerCase() || 'pending';

                if (status === 'pending') matrix[priority].pending++;
                else if (status === 'in progress') matrix[priority].progress++;
                else if (status === 'completed') matrix[priority].completed++;
            });

            // Update matrix cells
            ['high', 'medium', 'low'].forEach(priority => {
                document.getElementById(`matrix-${priority}-pending`).textContent = matrix[priority].pending;
                document.getElementById(`matrix-${priority}-progress`).textContent = matrix[priority].progress;
                document.getElementById(`matrix-${priority}-completed`).textContent = matrix[priority].completed;

                const total = matrix[priority].pending + matrix[priority].progress +
                             matrix[priority].completed;
                document.getElementById(`matrix-${priority}-total`).textContent = total;
            });
        }

        function toggleMetrics() {
            const content = document.getElementById('metricsContent');
            const icon = document.getElementById('metricsToggleIcon');

            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.textContent = '';
            } else {
                content.classList.add('collapsed');
                icon.textContent = '';
            }
        }

        function toggleGettingStarted() {
            const content = document.getElementById('gettingStartedContent');
            const icon = document.getElementById('gettingStartedToggle');

            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.textContent = '';
            } else {
                content.classList.add('collapsed');
                icon.textContent = '';
            }
        }

        function assignToMe(event, taskId) {
            event.stopPropagation();

            // Check if employees array exists and has items
            if (!employees || employees.length === 0) {
                alert('No employees loaded from Spreadsheet file. Please upload a spreadsheet file with an "Employees" sheet first.');
                return;
            }

            // Get list of employees from the loaded data
            // Try different property names (Name, name, or first property)
            const employeeList = employees.map(emp => {
                if (emp.Name) return emp.Name;
                if (emp.name) return emp.name;
                if (emp.Employee) return emp.Employee;
                if (emp.employee) return emp.employee;
                // If none of the above, try the first property value
                const firstValue = Object.values(emp)[0];
                return typeof firstValue === 'string' ? firstValue : null;
            }).filter(name => name && name.trim() !== '');

            if (employeeList.length === 0) {
                alert('No valid employee names found. Please ensure your Employees sheet has a "Name" column with employee names.');
                return;
            }

            // Show employee selection dropdown
            showEmployeeSelector(taskId, employeeList);
        }

        function showEmployeeSelector(taskId, employeeList) {
            // Remove any existing selector
            const existingSelector = document.getElementById('employeeSelector');
            if (existingSelector) {
                existingSelector.remove();
            }
            
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.id = 'employeeSelector';
            overlay.className = 'employee-selector-overlay';
            overlay.onclick = function(e) {
                if (e.target === overlay) {
                    overlay.remove();
                }
            };
            
            // Create modal content
            const modal = document.createElement('div');
            modal.className = 'employee-selector-modal';
            modal.onclick = function(e) {
                e.stopPropagation();
            };
            
            // Add header
            const header = document.createElement('div');
            header.className = 'employee-selector-header';
            header.innerHTML = '<h3> Select Employee</h3><button class="close-modal" onclick="document.getElementById(\'employeeSelector\').remove()"></button>';
            modal.appendChild(header);
            
            // Add employee list
            const listContainer = document.createElement('div');
            listContainer.className = 'employee-selector-list';
            
            employeeList.forEach(employeeName => {
                const item = document.createElement('div');
                item.className = 'employee-selector-item';
                item.innerHTML = `<span class="employee-icon"></span><span class="employee-name-text">${employeeName}</span>`;
                item.onclick = function() {
                    assignTaskToEmployee(taskId, employeeName);
                    overlay.remove();
                };
                listContainer.appendChild(item);
            });
            
            modal.appendChild(listContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
        }

        function assignTaskToEmployee(taskId, employeeName) {
            const task = allTasks.find(t => t.id === taskId);
            if (task) {
                const oldAssignee = task.Assigned;
                task.Assigned = employeeName;
                saveToLocalStorage();
                updateAvailableDates();
                applyFilters();
                showSuccessMessage(`Task reassigned from "${oldAssignee}" to "${employeeName}"!`);
            }
        }

        function changeEmployeeName() {
            alert('This feature is not needed anymore. Click on "Everyone" tasks to select from employee list.');
        }

        function scrollToCurrentTime(smooth = true) {
            const currentIndicator = document.querySelector('.current-time-indicator');
            if (currentIndicator) {
                const indicatorPosition = currentIndicator.getBoundingClientRect().top + window.scrollY;
                const windowHeight = window.innerHeight;
                const scrollPosition = indicatorPosition - (windowHeight / 2);

                // Mark as programmatic scroll to prevent triggering user scroll detection
                isProgrammaticScroll = true;
                isUserScrolling = false;
                window.scrollTo({ top: scrollPosition, behavior: smooth ? 'smooth' : 'auto' });

                // Clear programmatic flag after animation completes (smooth scroll takes ~500ms)
                setTimeout(() => {
                    isProgrammaticScroll = false;
                }, smooth ? 600 : 100);

                return true;
            }
            return false;
        }

        function startAutoFollow() {
            // Clear any existing interval
            if (autoFollowInterval) {
                clearInterval(autoFollowInterval);
            }

            // Scroll to current time every 30 seconds to keep it centered
            autoFollowInterval = setInterval(() => {
                if (isAtCurrentTime) {
                    scrollToCurrentTime(false); // Use auto scroll to avoid interrupting user
                }
            }, 30000); // Check every 30 seconds
        }

        function stopAutoFollow() {
            if (autoFollowInterval) {
                clearInterval(autoFollowInterval);
                autoFollowInterval = null;
            }
        }

        function toggleCurrentTime() {
            const floatingAnchor = document.getElementById('floatingAnchor');
            const anchorTooltip = document.getElementById('anchorTooltip');
            const anchorIcon = document.getElementById('anchorIcon');

            if (isAtCurrentTime) {
                // Go to top of page and stop auto-follow
                stopAutoFollow();
                isProgrammaticScroll = true;
                isUserScrolling = false;
                window.scrollTo({ top: 0, behavior: 'smooth' });

                // Clear programmatic flag after animation completes
                setTimeout(() => {
                    isProgrammaticScroll = false;
                }, 600);

                floatingAnchor.classList.remove('at-current');
                anchorIcon.textContent = '';
                anchorTooltip.textContent = 'Go to current time';
                isAtCurrentTime = false;
            } else {
                // Find the current time indicator line (always exists)
                if (scrollToCurrentTime(true)) {
                    floatingAnchor.classList.add('at-current');
                    anchorIcon.textContent = '';
                    anchorTooltip.textContent = 'Go to top';
                    isAtCurrentTime = true;

                    // Start auto-follow to keep current time centered
                    startAutoFollow();
                } else {
                    // No current time indicator found
                    alert('No current time indicator found. Make sure you are viewing today\'s tasks.');
                }
            }
        }

        // Reset the floating anchor state when user manually scrolls
        let scrollTimeout;
        let isUserScrolling = false;
        let isProgrammaticScroll = false;

        window.addEventListener('scroll', function(e) {
            // Only mark as user scrolling if it's not a programmatic scroll
            if (!isProgrammaticScroll) {
                isUserScrolling = true;
            }

            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(function() {
                // Check if we're still at the time indicator line
                const currentIndicator = document.querySelector('.current-time-indicator');
                if (currentIndicator && isAtCurrentTime) {
                    const indicatorRect = currentIndicator.getBoundingClientRect();
                    const windowHeight = window.innerHeight;

                    // Check if indicator is in the center zone (40%-60% of viewport)
                    const isInCenterZone = indicatorRect.top < windowHeight * 0.6 && indicatorRect.bottom > windowHeight * 0.4;

                    // Check if we're at the bottom of the page (can't scroll further)
                    const isAtBottom = (window.scrollY + window.innerHeight) >= (document.documentElement.scrollHeight - 10);

                    // Check if indicator is visible and below mid-screen
                    const isBelowMid = indicatorRect.top > windowHeight * 0.5 && indicatorRect.top < windowHeight;

                    // Treat as centered if: actually centered, OR at bottom with indicator visible below mid-screen
                    const isInCenter = isInCenterZone || (isAtBottom && isBelowMid);

                    if (!isInCenter && isUserScrolling) {
                        // User manually scrolled away, reset state and stop auto-follow
                        stopAutoFollow();
                        const floatingAnchor = document.getElementById('floatingAnchor');
                        const anchorTooltip = document.getElementById('anchorTooltip');
                        const anchorIcon = document.getElementById('anchorIcon');
                        floatingAnchor.classList.remove('at-current');
                        anchorIcon.textContent = '';
                        anchorTooltip.textContent = 'Go to current time';
                        isAtCurrentTime = false;
                    }
                }

                // Reset user scrolling flag
                isUserScrolling = false;
            }, 200);
        }, { passive: true });

        function toggleStatusDropdown(event, taskId) {
            event.stopPropagation();
            
            document.querySelectorAll('.status-dropdown').forEach(dd => {
                dd.classList.remove('show');
            });
            
            const dropdown = document.getElementById(`dropdown-${taskId}`);
            dropdown.classList.add('show');
        }

        document.addEventListener('click', function() {
            document.querySelectorAll('.status-dropdown').forEach(dd => {
                dd.classList.remove('show');
            });
        });

        function showSuccessMessage(message) {
            const existing = document.querySelector('.success-message');
            if (existing) existing.remove();

            const msg = document.createElement('div');
            msg.className = 'success-message';
            msg.innerHTML = `
                <span> ${message}</span>
                <button class="close-btn" onclick="this.parentElement.remove()"></button>
            `;
            document.querySelector('.content').insertBefore(msg, document.querySelector('.stats'));
            
            setTimeout(() => msg.remove(), 5000);
        }

        async function exportToExcel() {
            if (allTasks.length === 0) {
                alert('No tasks to export!');
                return;
            }

            // Calculate metrics
            const totalTasks = allTasks.length;
            const everydayTasks = allTasks.filter(t => t.isEveryday).length;
            const allDayTasks = allTasks.filter(t => t.isAllDay).length;
            const scheduledTasks = allTasks.filter(t => !t.isAllDay).length;

            const highPriority = allTasks.filter(t => t.Priority?.toLowerCase() === 'high').length;
            const mediumPriority = allTasks.filter(t => t.Priority?.toLowerCase() === 'medium').length;
            const lowPriority = allTasks.filter(t => t.Priority?.toLowerCase() === 'low').length;

            const pending = allTasks.filter(t => t.Status?.toLowerCase() === 'pending').length;
            const inProgress = allTasks.filter(t => t.Status?.toLowerCase() === 'in progress').length;
            const completed = allTasks.filter(t => t.Status?.toLowerCase() === 'completed').length;

            // Employee metrics (count each assignee separately for multi-assignee tasks)
            const employeeCounts = {};
            allTasks.forEach(task => {
                const assignees = task.assignees && task.assignees.length > 0 ? task.assignees : ['Unassigned'];
                assignees.forEach(employee => {
                    if (employee.toLowerCase() !== 'everyone') {
                        employeeCounts[employee] = (employeeCounts[employee] || 0) + 1;
                    }
                });
            });
            const sortedEmployees = Object.entries(employeeCounts).sort((a, b) => b[1] - a[1]);

            // Priority  Status Matrix
            const matrix = {
                high: { pending: 0, progress: 0, completed: 0 },
                medium: { pending: 0, progress: 0, completed: 0 },
                low: { pending: 0, progress: 0, completed: 0 }
            };

            allTasks.forEach(task => {
                const priority = (task.Priority || 'low').toLowerCase();
                const status = task.Status?.toLowerCase() || 'pending';

                if (status === 'pending') matrix[priority].pending++;
                else if (status === 'in progress') matrix[priority].progress++;
                else if (status === 'completed') matrix[priority].completed++;
            });

            // Create workbook with ExcelJS
            const workbook = new ExcelJS.Workbook();
            const worksheet = workbook.addWorksheet(' Report');

            // Define styles
            const titleStyle = { font: { bold: true, size: 14 }, alignment: { horizontal: 'center', vertical: 'middle' } };
            const sectionHeaderStyle = { font: { bold: true, size: 12 }, fill: { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFE0E0E0' } } };
            const headerStyle = { font: { bold: true }, alignment: { horizontal: 'center' }, fill: { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFD9D9D9' } } };
            const centerAlign = { alignment: { horizontal: 'center' } };
            const totalStyle = { font: { bold: true }, fill: { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFFFEB9C' } } };

            let currentRow = 1;

            // TITLE
            worksheet.mergeCells(`A${currentRow}:G${currentRow}`);
            worksheet.getCell(`A${currentRow}`).value = ' TASK REPORT - ' + formatDateForCSV(getLocalDateString());
            worksheet.getCell(`A${currentRow}`).style = titleStyle;
            currentRow += 2;

            // SUMMARY DASHBOARD
            worksheet.mergeCells(`A${currentRow}:G${currentRow}`);
            worksheet.getCell(`A${currentRow}`).value = ' SUMMARY DASHBOARD';
            worksheet.getCell(`A${currentRow}`).style = sectionHeaderStyle;
            currentRow++;

            // Task Overview
            worksheet.getCell(`A${currentRow}`).value = ' TASK OVERVIEW';
            worksheet.getCell(`A${currentRow}`).font = { bold: true };
            currentRow++;
            worksheet.getRow(currentRow).values = ['Type', 'Count'];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = headerStyle);
            currentRow++;

            const overviewData = [
                [' Total Tasks', totalTasks, 'FF6C757D'],
                [' Everyday', everydayTasks, 'FFF093FB'],
                [' All-Day', allDayTasks, 'FF667EEA'],
                [' Scheduled', scheduledTasks, 'FF3B82F6']
            ];
            overviewData.forEach(([label, count, color]) => {
                worksheet.getRow(currentRow).values = [label, count];
                worksheet.getCell(`A${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: color } };
                worksheet.getCell(`A${currentRow}`).font = { bold: true, color: { argb: 'FFFFFFFF' } };
                worksheet.getCell(`B${currentRow}`).style = centerAlign;
                currentRow++;
            });
            currentRow++;

            // PRIORITY BREAKDOWN
            worksheet.getCell(`A${currentRow}`).value = ' PRIORITY BREAKDOWN';
            worksheet.getCell(`A${currentRow}`).font = { bold: true };
            currentRow++;
            worksheet.getRow(currentRow).values = ['Priority', 'Count'];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = headerStyle);
            currentRow++;

            const priorityData = [
                [' High', highPriority, 'FFFF0000'],
                [' Medium', mediumPriority, 'FFFFA500'],
                [' Low', lowPriority, 'FF00B050']
            ];
            priorityData.forEach(([label, count, color]) => {
                worksheet.getRow(currentRow).values = [label, count];
                worksheet.getCell(`A${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: color } };
                worksheet.getCell(`A${currentRow}`).font = { bold: true, color: { argb: 'FFFFFFFF' } };
                worksheet.getCell(`B${currentRow}`).style = centerAlign;
                currentRow++;
            });
            worksheet.getRow(currentRow).values = ['Total', highPriority + mediumPriority + lowPriority];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = totalStyle);
            worksheet.getCell(`B${currentRow}`).style = { ...totalStyle, alignment: { horizontal: 'center' } };
            currentRow += 2;

            // STATUS BREAKDOWN
            worksheet.getCell(`A${currentRow}`).value = ' STATUS BREAKDOWN';
            worksheet.getCell(`A${currentRow}`).font = { bold: true };
            currentRow++;
            worksheet.getRow(currentRow).values = ['Status', 'Count'];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = headerStyle);
            currentRow++;

            const statusData = [
                [' Pending', pending, 'FFFFC000'],
                [' In Progress', inProgress, 'FF17A2B8'],
                [' Completed', completed, 'FF00B050']
            ];
            statusData.forEach(([label, count, color]) => {
                worksheet.getRow(currentRow).values = [label, count];
                worksheet.getCell(`A${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: color } };
                worksheet.getCell(`A${currentRow}`).font = { bold: true, color: { argb: 'FFFFFFFF' } };
                worksheet.getCell(`B${currentRow}`).style = centerAlign;
                currentRow++;
            });
            worksheet.getRow(currentRow).values = ['Total', pending + inProgress + completed];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = totalStyle);
            worksheet.getCell(`B${currentRow}`).style = { ...totalStyle, alignment: { horizontal: 'center' } };
            currentRow += 2;

            // EMPLOYEE BREAKDOWN
            worksheet.getCell(`A${currentRow}`).value = ' TASKS BY EMPLOYEE';
            worksheet.getCell(`A${currentRow}`).font = { bold: true };
            currentRow++;
            worksheet.getRow(currentRow).values = ['Employee', 'Tasks'];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = headerStyle);
            currentRow++;
            sortedEmployees.forEach(([name, count]) => {
                worksheet.getRow(currentRow).values = [name, count];
                worksheet.getCell(`B${currentRow}`).style = centerAlign;
                currentRow++;
            });
            worksheet.getRow(currentRow).values = ['Total', allTasks.length];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = totalStyle);
            worksheet.getCell(`B${currentRow}`).style = { ...totalStyle, alignment: { horizontal: 'center' } };
            currentRow += 2;

            // MATRIX SECTION
            worksheet.mergeCells(`A${currentRow}:F${currentRow}`);
            worksheet.getCell(`A${currentRow}`).value = ' PRIORITY  STATUS MATRIX';
            worksheet.getCell(`A${currentRow}`).style = sectionHeaderStyle;
            currentRow += 2;
            worksheet.getRow(currentRow).values = ['Priority', ' Pending', ' In Progress', ' Completed', 'Total'];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = headerStyle);
            currentRow++;

            const matrixData = [
                [' High', matrix.high.pending, matrix.high.progress, matrix.high.completed, 'FFFF0000'],
                [' Medium', matrix.medium.pending, matrix.medium.progress, matrix.medium.completed, 'FFFFA500'],
                [' Low', matrix.low.pending, matrix.low.progress, matrix.low.completed, 'FF00B050']
            ];
            matrixData.forEach(([label, pend, prog, comp, color]) => {
                const total = pend + prog + comp;
                worksheet.getRow(currentRow).values = [label, pend, prog, comp, total];
                worksheet.getCell(`A${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: color } };
                worksheet.getCell(`A${currentRow}`).font = { bold: true, color: { argb: 'FFFFFFFF' } };
                for (let col = 2; col <= 5; col++) {
                    worksheet.getCell(currentRow, col).style = centerAlign;
                }
                currentRow++;
            });
            worksheet.getRow(currentRow).values = ['Total', pending, inProgress, completed, allTasks.length];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = totalStyle);
            for (let col = 2; col <= 5; col++) {
                worksheet.getCell(currentRow, col).style = { ...totalStyle, alignment: { horizontal: 'center' } };
            }
            currentRow += 3;

            // TASK DETAILS
            worksheet.mergeCells(`A${currentRow}:H${currentRow}`);
            worksheet.getCell(`A${currentRow}`).value = ' TASK DETAILS';
            worksheet.getCell(`A${currentRow}`).style = sectionHeaderStyle;
            currentRow += 2;

            const tasksHeaderRow = currentRow;
            worksheet.getRow(currentRow).values = ['Date', 'Time', 'Task', 'Description', 'Priority', 'Assigned', 'Status', 'Subtasks'];
            worksheet.getRow(currentRow).eachCell(cell => cell.style = headerStyle);
            currentRow++;

            allTasks.forEach(task => {
                // Join subtasks array back to newline-separated string for Excel
                const subtasksStr = task.subtasks && task.subtasks.length > 0
                    ? task.subtasks.join('\n')
                    : '';
                // Join assignees array back to comma-separated string for Excel
                const assigneesStr = task.assignees && task.assignees.length > 0
                    ? task.assignees.join(', ')
                    : 'Everyone';
                worksheet.getRow(currentRow).values = [
                    task.isEveryday ? 'Everyday' : formatDateForCSV(task.normalizedDate || task.Date || ''),
                    task.Time || 'All Day',
                    task.Task || '',
                    task.Description || '',
                    task.Priority || 'Low',
                    assigneesStr,
                    task.Status || 'Pending',
                    subtasksStr
                ];
                // Enable text wrap for subtasks column
                worksheet.getCell(`H${currentRow}`).alignment = { wrapText: true, vertical: 'top' };
                currentRow++;
            });

            // Set column widths
            worksheet.columns = [
                { width: 15 },  // Date
                { width: 12 },  // Time
                { width: 25 },  // Task
                { width: 50 },  // Description
                { width: 12 },  // Priority
                { width: 18 },  // Assigned
                { width: 15 },  // Status
                { width: 30 }   // Subtasks
            ];

            // Add auto-filter
            worksheet.autoFilter = {
                from: { row: tasksHeaderRow, column: 1 },
                to: { row: currentRow - 1, column: 8 }
            };

            // Export file
            const buffer = await workbook.xlsx.writeBuffer();
            const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Tasks_Report_${formatDateForCSV(getLocalDateString())}.xlsx`;
            a.click();
            URL.revokeObjectURL(url);

            showSuccessMessage('Spreadsheet report exported with professional formatting!');
        }

        function exportForTV() {
            if (allTasks.length === 0) {
                alert('No tasks loaded! Please import a spreadsheet file first.');
                return;
            }

            try {
                // Get the current document HTML
                const doctype = '<!DOCTYPE html>\n';
                const htmlClone = document.documentElement.cloneNode(true);

                // Create a script element with embedded data
                const scriptEl = document.createElement('script');
                scriptEl.id = 'embedded-tv-data';
                scriptEl.textContent = `
        // ============================================
        // EMBEDDED DATA FOR STANDALONE TV MODE
        // This script runs immediately to pre-load data into localStorage
        // ============================================
        (function() {
            const EMBEDDED_TASKS = ${JSON.stringify(allTasks)};
            const EMBEDDED_EMPLOYEES = ${JSON.stringify(employees)};
            const EMBEDDED_TEMPLATES = ${JSON.stringify(taskTemplates)};

            // Immediately save to localStorage so the main app loads it
            const data = {
                tasks: EMBEDDED_TASKS,
                templates: EMBEDDED_TEMPLATES,
                employees: EMBEDDED_EMPLOYEES
            };
            localStorage.setItem('excelTaskCalendarFullDay', JSON.stringify(data));
            console.log(' TV Mode: Pre-loaded', EMBEDDED_TASKS.length, 'tasks into localStorage');
        })();
        // ============================================
`;

                // Insert the script into the cloned head
                const headEl = htmlClone.querySelector('head');
                headEl.insertBefore(scriptEl, headEl.firstChild);

                // Get the modified HTML
                let modifiedHTML = doctype + htmlClone.outerHTML;

                // Hide the "Export for TV" button in the standalone version
                modifiedHTML = modifiedHTML.replace(
                    'id="exportTVButton"',
                    'id="exportTVButton" style="display: none !important;"'
                );

                // Hide the entire file upload section in standalone mode
                modifiedHTML = modifiedHTML.replace(
                    'id="fileUploadSection"',
                    'id="fileUploadSection" style="display: none !important;"'
                );

                // Hide the Clear Data button in standalone mode
                modifiedHTML = modifiedHTML.replace(
                    'onclick="clearAllData()"',
                    'onclick="clearAllData()" style="display: none !important;"'
                );

                // Add a banner indicating this is a TV standalone version
                const tvBanner = `
            <div style="background: #a7f3d0; color: #166534; padding: 12px; text-align: center; font-weight: bold; font-size: 1em; border-bottom: 1px solid #86efac;">
                 TV Standalone Mode - Data Embedded | ${allTasks.length} Tasks Loaded
            </div>
`;
                modifiedHTML = modifiedHTML.replace('<div class="container">', '<div class="container">' + tvBanner);

                // Create and download the file
                const blob = new Blob([modifiedHTML], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `TaskManager-TV-Standalone-${allTasks.length}Tasks-${formatDateForCSV(getLocalDateString())}.html`;
                a.click();
                URL.revokeObjectURL(url);

                showSuccessMessage(`TV Standalone file created with ${allTasks.length} tasks! Copy to flash drive for your Smart TV.`);
            } catch (error) {
                console.error('Export error:', error);
                alert('Error creating TV standalone file: ' + error.message);
            }
        }

        function downloadTemplate() {
            // TODO: Replace this URL with your actual GitHub raw file URL
            // Example: https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/Database.xlsx
            const templateUrl = 'GITHUB_RAW_URL_PLACEHOLDER';

            // Open the template URL in a new tab to trigger download
            const link = document.createElement('a');
            link.href = templateUrl;
            link.download = 'Database.xlsx';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showSuccessMessage('Template download started! Edit and upload.');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? All tasks will be removed.')) {
                allTasks = [];
                taskTemplates = [];
                employees = [];
                localStorage.removeItem(STORAGE_KEY);
                document.getElementById('fileName').textContent = '';
                document.getElementById('dropArea').classList.remove('has-file');

                // Reset date picker to today - force it
                const today = getLocalDateString();
                const dateInput = document.getElementById('dateFilter');
                dateInput.value = '';
                dateInput.setAttribute('value', today);
                dateInput.value = today;
                currentFilterDate = today;

                // Clear search/filter fields
                document.getElementById('searchBox').value = '';
                document.getElementById('priorityFilter').value = '';
                document.getElementById('statusFilter').value = '';

                // Reset search button state
                isSearchActive = false;
                updateSearchButton();

                createDemoData();
                saveToLocalStorage();
                updateAvailableDates();
                applyFilters();
                showSuccessMessage('Data cleared! Please upload a spreadsheet file to load tasks.');
            }
        }

        // Drag and drop functionality - works on entire page
        const dropArea = document.getElementById('dropArea');

        // Prevent default drag behaviors on entire document
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            document.body.addEventListener(eventName, preventDefaults, false);
            document.documentElement.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Show drag-over effect when dragging over entire page
        ['dragenter', 'dragover'].forEach(eventName => {
            document.body.addEventListener(eventName, () => {
                dropArea.classList.add('drag-over');
            }, false);
        });

        // Remove drag-over effect when leaving page or dropping
        ['dragleave', 'drop'].forEach(eventName => {
            document.body.addEventListener(eventName, (e) => {
                // Only remove if we're actually leaving the document
                if (e.target === document.body || e.target === document.documentElement) {
                    dropArea.classList.remove('drag-over');
                }
            }, false);
        });

        // Handle drop on entire document
        document.body.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            dropArea.classList.remove('drag-over');
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                document.getElementById('excelFile').files = files;
                handleFileUpload(files[0]);
            }
        }

        let isProcessingFile = false;
        document.getElementById('excelFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && !isProcessingFile) {
                isProcessingFile = true;
                handleFileUpload(file);
                // Reset the flag after a short delay to allow re-uploads
                setTimeout(() => {
                    isProcessingFile = false;
                }, 1000);
            }
        });

        function handleFileUpload(file) {
            if (!file) return;

            document.getElementById('fileName').textContent = ` ${file.name}`;
            document.getElementById('dropArea').classList.add('has-file');

            // Clear the file input to allow re-selection of the same file and prevent browser issues
            const fileInput = document.getElementById('excelFile');

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = new Uint8Array(event.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });

                    allTasks = [];
                    taskTemplates = [];
                    employees = [];

                    if (workbook.SheetNames.includes('Tasks')) {
                        const tasksSheet = workbook.Sheets['Tasks'];
                        // Skip first 2 instruction rows, start from row 3 which has headers
                        const tasksData = XLSX.utils.sheet_to_json(tasksSheet, { range: 2 });

                        // Filter out empty rows - must have at least a Date or Task
                        allTasks = tasksData
                            .filter(task => task.Date || task.Task)
                            .map((task, index) => {
                                const normalizedTime = normalizeTime(task.Time);
                                const normalizedDateValue = normalizeDate(task.Date);
                                // Parse subtasks - split by newlines, filter empty lines
                                const subtasks = task.Subtasks
                                    ? String(task.Subtasks).split(/\r?\n/).map(s => s.trim()).filter(s => s)
                                    : [];
                                // Parse assignees - split by commas, filter empty
                                const assignedRaw = task.Assigned || 'Everyone';
                                const assignees = String(assignedRaw).split(',').map(s => s.trim()).filter(s => s);
                                return {
                                    ...task,
                                    id: task.id || `task_${Date.now()}_${index}`,
                                    normalizedDate: normalizedDateValue,
                                    Time: normalizedTime,
                                    isAllDay: !normalizedTime || normalizedTime === null,
                                    isEveryday: !normalizedDateValue || normalizedDateValue === null,
                                    Assigned: assignedRaw,
                                    assignees: assignees,
                                    Status: task.Status || '',
                                    hasPriority: !!task.Priority,
                                    hasStatus: !!task.Status,
                                    subtasks: subtasks
                                };
                            });
                    }

                    if (workbook.SheetNames.includes('TaskTemplates')) {
                        const templatesSheet = workbook.Sheets['TaskTemplates'];
                        taskTemplates = XLSX.utils.sheet_to_json(templatesSheet);
                    }

                    if (workbook.SheetNames.includes('Employees')) {
                        const employeesSheet = workbook.Sheets['Employees'];
                        employees = XLSX.utils.sheet_to_json(employeesSheet);
                    }

                    saveToLocalStorage();
                    // Collapse the getting started section after file upload
                    const content = document.getElementById('gettingStartedContent');
                    const icon = document.getElementById('gettingStartedToggle');
                    if (!content.classList.contains('collapsed')) {
                        content.classList.add('collapsed');
                        icon.textContent = '';
                    }

                    // Reset search button state
                    isSearchActive = false;
                    updateSearchButton();

                    // Update available dates before showing today
                    updateAvailableDates();
                    showToday();

                    // Show appropriate message based on what's displayed
                    if (filteredTasks.length > 0) {
                        const displayDate = new Date(currentFilterDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                        showSuccessMessage(`File loaded: ${file.name} - ${allTasks.length} tasks imported. Showing ${filteredTasks.length} tasks for ${displayDate}`);
                    } else {
                        showSuccessMessage(`File loaded: ${file.name} - ${allTasks.length} tasks imported. Click a date chip below the date picker to view tasks.`);
                    }

                    // Show the "Export for TV" button after data is loaded
                    document.getElementById('exportTVButton').style.display = 'inline-flex';

                    // Clear the file input value to prevent re-triggering and allow same file re-upload
                    fileInput.value = '';
                } catch (error) {
                    alert('Error reading Spreadsheet file: ' + error.message);
                    document.getElementById('fileName').textContent = '';
                    document.getElementById('dropArea').classList.remove('has-file');
                    // Clear the file input value on error too
                    fileInput.value = '';
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function normalizeDate(dateStr) {
            if (!dateStr) return null;

            if (typeof dateStr === 'number') {
                const date = XLSX.SSF.parse_date_code(dateStr);
                return `${date.y}-${String(date.m).padStart(2, '0')}-${String(date.d).padStart(2, '0')}`;
            }

            let date = new Date(dateStr);
            if (isNaN(date.getTime())) return null;
            return getLocalDateString(date);
        }

        function normalizeTime(timeValue) {
            if (!timeValue) return null;

            let hours, minutes;

            // If it's a number (Excel stores time as fraction of a day)
            if (typeof timeValue === 'number') {
                const totalMinutes = Math.round(timeValue * 24 * 60);
                hours = Math.floor(totalMinutes / 60);
                minutes = totalMinutes % 60;
            }
            // If it's already a string
            else if (typeof timeValue === 'string') {
                // Remove seconds if present (h:mm:ss -> h:mm)
                let cleaned = timeValue.replace(/:\d{2}\s*(AM|PM)?$/i, match => {
                    return match.includes('AM') || match.includes('PM') ? ' ' + match.match(/(AM|PM)/i)[0] : '';
                });

                // Parse time
                const match = cleaned.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?/i);
                if (match) {
                    hours = parseInt(match[1]);
                    minutes = parseInt(match[2]);
                    const period = match[3];

                    // If already has AM/PM, convert to 24-hour first
                    if (period) {
                        if (period.toUpperCase() === 'PM' && hours !== 12) {
                            hours += 12;
                        } else if (period.toUpperCase() === 'AM' && hours === 12) {
                            hours = 0;
                        }
                    }
                } else {
                    return null;
                }
            } else {
                return null;
            }

            // Convert to 12-hour format with AM/PM
            const period = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12; // Convert 0 to 12, and 13-23 to 1-11

            return `${String(displayHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')} ${period}`;
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', function() {
            // Apply animation interval settings dynamically
            if (ANIMATION_INTERVAL !== '10s') {
                const style = document.createElement('style');
                style.textContent = `
                    .current-time-indicator { animation-duration: ${ANIMATION_INTERVAL} !important; }
                    .current-time-indicator::before { animation-duration: ${ANIMATION_INTERVAL} !important; }
                    .task-card.current { animation-duration: ${ANIMATION_INTERVAL} !important; }
                `;
                document.head.appendChild(style);
            }

            // Always set date to today on page load (prevents browser cache issues)
            const today = getLocalDateString();
            const dateInput = document.getElementById('dateFilter');

            console.log('Today is (LOCAL):', today);
            console.log('Date input initial value:', dateInput.value);

            // Aggressively clear any browser-cached value
            dateInput.value = '';
            dateInput.removeAttribute('value');
            dateInput.removeAttribute('defaultValue');

            // Disable the input temporarily to prevent browser interference
            dateInput.disabled = true;

            // Use multiple timeouts to fight against browser autofill
            setTimeout(function() {
                dateInput.value = '';
                console.log('After 50ms clear, date input value:', dateInput.value);
            }, 50);

            setTimeout(function() {
                // Aggressively set the date value
                dateInput.value = today;
                currentFilterDate = today;
                console.log('After 200ms set, date input value:', dateInput.value);
                console.log('currentFilterDate:', currentFilterDate);
            }, 200);

            setTimeout(function() {
                // Final setup
                dateInput.disabled = false;

                console.log('Final check - Date input value:', dateInput.value);
                console.log('Final check - currentFilterDate:', currentFilterDate);

                // Force it one more time if it's wrong
                if (dateInput.value !== today) {
                    console.error('BROWSER CHANGED DATE! Was:', dateInput.value, 'Setting to:', today);
                    dateInput.value = today;
                    currentFilterDate = today;
                }

                // Add the change event listener AFTER setting the initial value
                dateInput.addEventListener('change', filterByDate);

                // Initialize search button state
                isSearchActive = false;
                updateSearchButton();

                // Load data and display
                if (!loadFromLocalStorage()) {
                    createDemoData();
                    saveToLocalStorage();
                }

                // Show "Export for TV" button if there's data loaded
                if (allTasks.length > 0) {
                    document.getElementById('exportTVButton').style.display = 'inline-flex';
                }

                updateAvailableDates();

                // Apply filters to show today's tasks
                applyFilters();

                // Set up a watchdog to keep checking the date for first 5 seconds
                let watchdogCount = 0;
                const watchdogInterval = setInterval(function() {
                    watchdogCount++;
                    if (dateInput.value !== today) {
                        console.error('WATCHDOG: Date changed to', dateInput.value, '! Resetting to today:', today);
                        dateInput.value = today;
                        currentFilterDate = today;
                        applyFilters();
                    }
                    if (watchdogCount >= 10) {
                        clearInterval(watchdogInterval);
                        console.log('Watchdog stopped. Final date:', dateInput.value);
                    }
                }, 500);
            }, 300);

            // Start clock and minute update intervals
            updateClock();
            let lastMinute = new Date().getMinutes();
            let lastDate = getLocalDateString();
            clockInterval = setInterval(updateClock, 1000);
            minuteInterval = setInterval(function() {
                const currentMinute = new Date().getMinutes();
                const currentDate = getLocalDateString();

                // Check for date change (midnight)
                if (currentDate !== lastDate) {
                    lastDate = currentDate;
                    console.log('Midnight detected! Switching to new date:', currentDate);
                    showToday();
                    showSuccessMessage(`New day! Switched to ${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}`);
                }

                // Update time indicator position every minute
                if (currentMinute !== lastMinute) {
                    lastMinute = currentMinute;
                    if (currentFilterDate) {
                        applyFilters();
                    }
                }
            }, 1000);
        });

        // Clean up intervals on page unload
        window.addEventListener('beforeunload', function() {
            stopAutoFollow();
            if (clockInterval) clearInterval(clockInterval);
            if (minuteInterval) clearInterval(minuteInterval);
        });
    </script>
</body>
</html>
